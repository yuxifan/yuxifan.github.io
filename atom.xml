<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yuxi Fan</title>
  <subtitle>Yuxi&#39;s development blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.yuxifan.com/"/>
  <updated>2017-07-28T08:16:38.597Z</updated>
  <id>https://www.yuxifan.com/</id>
  
  <author>
    <name>Yuxi</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Setup python development environment for Steem on Ubuntu 16</title>
    <link href="https://www.yuxifan.com/2017/07/28/setup-python-steem-development-environment/"/>
    <id>https://www.yuxifan.com/2017/07/28/setup-python-steem-development-environment/</id>
    <published>2017-07-28T04:51:12.000Z</published>
    <updated>2017-07-28T08:16:38.597Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/steem/python-steem.png" alt="Python &amp; Steem"></p>
<h2 id="Install-python-3"><a href="#Install-python-3" class="headerlink" title="Install python 3"></a>Install python 3</h2><p>Both Python 3 and Python 2 have been pre-installed on Ubuntu 16, you just need to make sure you have the latest versions by running:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get -y upgrade</div></pre></td></tr></table></figure>
<p>Then run the following command to check the version of Python 3:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python -v</div></pre></td></tr></table></figure>
<p>You also need to install pip to manage software packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y python3-pip</div></pre></td></tr></table></figure>
<p>Install development libraries:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install build-essential libffi-dev libssl-dev python3-dev</div></pre></td></tr></table></figure>
<h2 id="Setting-up-a-virtual-environment"><a href="#Setting-up-a-virtual-environment" class="headerlink" title="Setting up a virtual environment"></a>Setting up a virtual environment</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install python3-venv</div><div class="line">mkdir environments</div><div class="line"><span class="built_in">cd</span> environments</div><div class="line">python3 -m venv myenv</div><div class="line"><span class="built_in">source</span> myenv/bin/activate</div></pre></td></tr></table></figure>
<h2 id="Setting-up-python-steem-libraries"><a href="#Setting-up-python-steem-libraries" class="headerlink" title="Setting up python steem libraries"></a>Setting up python steem libraries</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pip3 install wheel </div><div class="line">pip3 install piston-lib</div><div class="line">pip3 install steem</div></pre></td></tr></table></figure>
<h2 id="Test-it-works"><a href="#Test-it-works" class="headerlink" title="Test it works"></a>Test it works</h2><p>To test the development environment has been set up correctly, run the following script to list the tags used by latest posts:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> piston <span class="keyword">import</span> Steem</div><div class="line">steem = Steem()</div><div class="line"><span class="keyword">for</span> c <span class="keyword">in</span> steem.stream_comments():</div><div class="line">  <span class="keyword">if</span> c.is_main_post():</div><div class="line">    <span class="keyword">print</span> (c.meta[<span class="string">"tags"</span>])</div></pre></td></tr></table></figure>
<p><img src="https://steemitimages.com/DQmU3Qdt7dKuahNv3gtrRkFhcRQz3becPzXRWa3Kc56HTni/image.png" alt=""></p>
<p>Originally posted on <a href="https://steemit.com" rel="external nofollow noopener noreferrer" target="_blank">https://steemit.com</a>. Thank you for reading my post, feel free to FOLLOW and Upvote @yuxi, which will motivate me to create more quality posts.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/steem/python-steem.png&quot; alt=&quot;Python &amp;amp; Steem&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Install-python-3&quot;&gt;&lt;a href=&quot;#Install-python-3&quot; class
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="Linux" scheme="https://www.yuxifan.com/tags/Linux/"/>
    
      <category term="Python" scheme="https://www.yuxifan.com/tags/Python/"/>
    
      <category term="Steem" scheme="https://www.yuxifan.com/tags/Steem/"/>
    
  </entry>
  
  <entry>
    <title>Multi-select facting in Java</title>
    <link href="https://www.yuxifan.com/2017/07/21/multi-select-faceting/"/>
    <id>https://www.yuxifan.com/2017/07/21/multi-select-faceting/</id>
    <published>2017-07-21T21:51:12.000Z</published>
    <updated>2017-07-21T14:47:44.170Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/java/solr.png" alt="Apache Solr"></p>
<h2 id="What-is-multi-select-facting"><a href="#What-is-multi-select-facting" class="headerlink" title="What is multi-select facting?"></a>What is multi-select facting?</h2><p>Multi-select faceting means that users can see and select multiple facet items (facet values) for particular facets. Thanks to Solr’s filter tagging and excluding features to support this type of faceting.</p>
<h2 id="Online-PC-shop-example"><a href="#Online-PC-shop-example" class="headerlink" title="Online PC shop example"></a>Online PC shop example</h2><p>For example, we have 2 facets: memory, and brand. We want to support multi-select faceting because while searching, users may want to choose a range of memory size e.g. 4GB-8GB and a list of interested brands, e.g. Lenovo and HP. </p>
<p>From the initial search of keyword “Home desktop PC”, the result looks like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">------memory------     ------brand------      </div><div class="line">[  ]  2GB (30)             [  ] Acer (13)</div><div class="line">[  ]  4GB (50)             [  ] HP (20)</div><div class="line">[  ]  8GB (25)             [  ] Lenovo (33)</div><div class="line">[  ]  16GB (10)            [  ] Toshiba (20)</div></pre></td></tr></table></figure>
<p>Then user may want to narrow down the search results by selecting 4GB and 8GB in memory facet,  also HP and Lenovo in the brand facet. </p>
<p>Ideally, after selecting 4GB and 8GB, users expect to see:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">------memory------     ------brand------      </div><div class="line">[ ]  2GB (30)             [  ] Acer (5)</div><div class="line">[x]  4GB (50)             [  ] HP (10)</div><div class="line">[x]  8GB (25)             [  ] Lenovo (13)</div><div class="line">[ ]  16GB (10)            [  ] Toshiba (10)</div></pre></td></tr></table></figure>
<p>You may notice that the numbers after each brand facet item is also changed. That is just because the search results have been narrowed down after first select of “4GB” and “8GB” in memory facet. </p>
<h2 id="Solr-query-to-support-multi-select-faceting"><a href="#Solr-query-to-support-multi-select-faceting" class="headerlink" title="Solr query to support multi-select faceting"></a>Solr query to support multi-select faceting</h2><p>According to <a href="https://wiki.apache.org/solr/SimpleFacetParameters#Multi-Select_Faceting_and_LocalParams" rel="external nofollow noopener noreferrer" target="_blank">solr’s documentation</a>, tagging and excluding filters can be used to perform the multi-select faceting.</p>
<p>The solr query is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">q=Home%20desktop%20PC&amp;facet=on&amp;facet.field=&#123;!ex=tagmem&#125;&amp;fq=&#123;!tag=tagmem&#125; memory:%28%224GB%208GB%22%29&amp;facet.field=&#123;!ex=tagbrand&#125;&amp;fq=&#123;!tag=tagbrand&#125;brand:%28%22Lenobo%20HP%22%29</div></pre></td></tr></table></figure>
<p>Human readable version (should not send it to Solr in your application):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">q=Home desktop PC&amp;facet=on&amp;facet.field=&#123;!ex=tagmem&#125;&amp;fq=&#123;!tag=tagmem&#125;memory:(<span class="string">"4GB"</span> <span class="string">"8GB"</span>)&amp;facet.field=&#123;!ex=tagbrand&#125;&amp;fq=&#123;!tag=tagbrand&#125;brand:(<span class="string">"Lenobo"</span> <span class="string">"HP"</span>)</div></pre></td></tr></table></figure>
<h2 id="Solrj-implementation"><a href="#Solrj-implementation" class="headerlink" title="Solrj implementation"></a>Solrj implementation</h2><p>For facet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SolrQuery query = <span class="keyword">new</span> SolrQuery();</div><div class="line">......</div><div class="line">query.addFacetField(<span class="string">"&#123;!ex=tagmem&#125;memory"</span>;</div><div class="line">......</div><div class="line">query.addFacetField(<span class="string">"&#123;!ex=tagbrand&#125;brand"</span>;</div></pre></td></tr></table></figure>
<p>For facet items:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">query.addFilterQuery(<span class="string">"&#123;!tag=tagbrand&#125;brand:"</span>+YOUR_BRAND_FACET_VALUES_FROM_FRONTEND)</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      multi-select facting in Java
    
    </summary>
    
      <category term="java" scheme="https://www.yuxifan.com/categories/java/"/>
    
    
      <category term="java" scheme="https://www.yuxifan.com/tags/java/"/>
    
      <category term="solr" scheme="https://www.yuxifan.com/tags/solr/"/>
    
      <category term="faceting" scheme="https://www.yuxifan.com/tags/faceting/"/>
    
  </entry>
  
  <entry>
    <title>Upload via SFTP in Java</title>
    <link href="https://www.yuxifan.com/2017/07/14/upload-via-sftp-in-java/"/>
    <id>https://www.yuxifan.com/2017/07/14/upload-via-sftp-in-java/</id>
    <published>2017-07-14T11:51:12.000Z</published>
    <updated>2017-07-20T08:30:21.552Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/sftp.png" alt=""></p>
<h2 id="1-Add-Maven-dependency"><a href="#1-Add-Maven-dependency" class="headerlink" title="1) Add Maven dependency"></a>1) Add Maven dependency</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.42<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2-Java-code"><a href="#2-Java-code" class="headerlink" title="2) Java code"></a>2) Java code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.jcraft.jsch.Channel;</div><div class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelSftp;</div><div class="line"><span class="keyword">import</span> com.jcraft.jsch.JSch;</div><div class="line"><span class="keyword">import</span> com.jcraft.jsch.Session;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJSftp</span> </span>&#123;</div><div class="line">       </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(String username,</span></span></div><div class="line">                              String password,</div><div class="line">                              String host,</div><div class="line">                              <span class="keyword">int</span> port,</div><div class="line">                              String workingDir,</div><div class="line">                              String localFilename)&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            JSch jsch = <span class="keyword">new</span> JSch();</div><div class="line">            Session session = jsch.getSession(username, host, port);</div><div class="line">            session.setPassword(password);</div><div class="line">            java.util.Properties config = <span class="keyword">new</span> java.util.Properties();</div><div class="line">            config.put(<span class="string">"StrictHostKeyChecking"</span>, <span class="string">"no"</span>);</div><div class="line">            session.setConfig(config);</div><div class="line">            session.connect();</div><div class="line">            Channel channel = session.openChannel(<span class="string">"sftp"</span>);</div><div class="line">            channel.connect();</div><div class="line">            ChannelSftp channelSftp = (ChannelSftp) channel;</div><div class="line">            channelSftp.cd(workingDir);</div><div class="line">    </div><div class="line">            File f1 = <span class="keyword">new</span> File(localFilename);</div><div class="line">            channelSftp.put(<span class="keyword">new</span> FileInputStream(f1), f1.getName(), ChannelSftp.OVERWRITE);</div><div class="line">                </div><div class="line">            channelSftp.exit();</div><div class="line">            session.disconnect();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      Upload via SFTP in Java
    
    </summary>
    
      <category term="java" scheme="https://www.yuxifan.com/categories/java/"/>
    
    
      <category term="java" scheme="https://www.yuxifan.com/tags/java/"/>
    
      <category term="sftp" scheme="https://www.yuxifan.com/tags/sftp/"/>
    
  </entry>
  
  <entry>
    <title>Implementing Shibboleth login in Rails application</title>
    <link href="https://www.yuxifan.com/2017/07/07/implementing-shibboleth-in-rails/"/>
    <id>https://www.yuxifan.com/2017/07/07/implementing-shibboleth-in-rails/</id>
    <published>2017-07-07T11:51:12.000Z</published>
    <updated>2017-07-07T14:48:09.295Z</updated>
    
    <content type="html"><![CDATA[<p>Further to the basic configuration to <a href="/2017/07/04/configure-shibboleth-service-provider-ubuntu-16/">make Shibboleth working with Apache 2</a>, it’s time to configure Rails application with Shibboleth. You may want to get Phusion Passenger working first, here is the tutorial: <a href="/2017/07/07/phusion-passenger/">Setting up Phusion Passenger with Apache2</a>.</p>
<p><img src="/images/ruby/rails.png" alt="Rails"></p>
<h2 id="0-Environements"><a href="#0-Environements" class="headerlink" title="0) Environements"></a>0) Environements</h2><p>Ubuntu: 16<br>Apache: 2.4.7<br>Ruby: 2.3.1<br>Phusion Passenger: 5.1.5<br>Shibboleth: 2.5.2</p>
<h2 id="1-Configure-Apache2"><a href="#1-Configure-Apache2" class="headerlink" title="1) Configure Apache2"></a>1) Configure Apache2</h2><p>First, edit /etc/apache2/sites-enabled/default-ssl.conf and add:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Location <span class="string">"/Shibboleth.sso"</span>&gt;</div><div class="line">  Require all granted</div><div class="line">  PassengerEnabled off</div><div class="line">&lt;/Location&gt;</div></pre></td></tr></table></figure>
<p>and</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Location <span class="string">"/users/auth/shibboleth"</span>&gt;</div><div class="line">  AuthType shibboleth</div><div class="line">  ShibRequestSetting requireSession 1</div><div class="line">  require valid-user</div><div class="line">&lt;/Location&gt;</div></pre></td></tr></table></figure>
<p>You may want to comment out the following line in /etc/apache2/apache2.conf, otherwise, you have to grant acess to each individual path.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#&lt;Directory /&gt;</span></div><div class="line"><span class="comment">#       Options FollowSymLinks</span></div><div class="line"><span class="comment">#       AllowOverride None</span></div><div class="line"><span class="comment">#       Require all denied</span></div><div class="line"><span class="comment">#&lt;/Directory&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2-Configure-develop-Rails-application-to-support-Shibooleth"><a href="#2-Configure-develop-Rails-application-to-support-Shibooleth" class="headerlink" title="2) Configure/develop Rails application to support Shibooleth"></a>2) Configure/develop Rails application to support Shibooleth</h2><h3 id="2-1-Add-gem-‘omniauth-shibboleth’-into-Gemfile-and-run"><a href="#2-1-Add-gem-‘omniauth-shibboleth’-into-Gemfile-and-run" class="headerlink" title="2.1) Add gem ‘omniauth-shibboleth’ into Gemfile and run"></a>2.1) Add gem ‘omniauth-shibboleth’ into Gemfile and run</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle install</div></pre></td></tr></table></figure>
<h3 id="2-2-Edit-config-initializers-devise-rb"><a href="#2-2-Edit-config-initializers-devise-rb" class="headerlink" title="2.2) Edit config/initializers/devise.rb:"></a>2.2) Edit config/initializers/devise.rb:</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">config.omniauth <span class="symbol">:shibboleth</span>, &#123;<span class="symbol">:uid_field</span> =&gt; <span class="string">'eppn'</span>,</div><div class="line">                                <span class="symbol">:info_fields</span> =&gt; &#123;</div><div class="line">                                <span class="symbol">:affiliation</span> =&gt; lambda &#123;<span class="params">|request_param|</span> request_param.call(<span class="string">'unscoped-affiliation'</span>).split(<span class="string">';'</span>)&#125;,</div><div class="line">                                &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-3-Edit-app-models-user-rb"><a href="#2-3-Edit-app-models-user-rb" class="headerlink" title="2.3) Edit app/models/user.rb"></a>2.3) Edit app/models/user.rb</h3><p>Add method:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">from_omniauth</span><span class="params">(auth)</span></span></div><div class="line">    where(<span class="symbol">provider:</span> auth.provider, <span class="symbol">uid:</span> auth.uid).first_or_create <span class="keyword">do</span> <span class="params">|user|</span></div><div class="line">      user.provider = auth.provider</div><div class="line">      user.uid      = auth.uid</div><div class="line">      user.email    = auth.uid</div><div class="line">      user.password = Devise.friendly_token[<span class="number">0</span>,<span class="number">20</span>]</div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Also add :omniauthable to declaration in user.rb</p>
<h3 id="2-4-Add-a-controller-e-g-app-controllers-omniauthcallbacks-controller-rb"><a href="#2-4-Add-a-controller-e-g-app-controllers-omniauthcallbacks-controller-rb" class="headerlink" title="2.4) Add a controller, e.g. app/controllers/omniauthcallbacks_controller.rb"></a>2.4) Add a controller, e.g. app/controllers/omniauthcallbacks_controller.rb</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OmniauthcallbacksController</span> &lt; Devise::OmniauthCallbacksController</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">shibboleth</span></span></div><div class="line">    @user = User.from_omniauth(request.env[<span class="string">"omniauth.auth"</span>])</div><div class="line">    session[<span class="string">'shib_user_data'</span>] = request.env[<span class="string">"omniauth.auth"</span>]</div><div class="line">    sign_in_and_redirect @user</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">failure</span></span></div><div class="line">    redirect_to new_local_user_session_path, <span class="symbol">:notice</span> =&gt; <span class="string">"Cannot login via Shibboleth - redirect to local login ..."</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h3 id="2-5-edit-config-routes-rb"><a href="#2-5-edit-config-routes-rb" class="headerlink" title="2.5) edit config/routes.rb"></a>2.5) edit config/routes.rb</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">devise_for <span class="symbol">:users</span>, <span class="symbol">:controllers</span> =&gt; &#123; <span class="symbol">:omniauth_callbacks</span> =&gt; <span class="string">"omniauthcallbacks"</span> &#125;, <span class="symbol">:skip</span> =&gt; [<span class="symbol">:sessions</span>]</div></pre></td></tr></table></figure>
<p>Run:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g migration AddColumnsToUsers provider uid</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure></p>
<h3 id="2-6-edit-routes-rb-and-add"><a href="#2-6-edit-routes-rb-and-add" class="headerlink" title="2.6) edit routes.rb and add:"></a>2.6) edit routes.rb and add:</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">devise_scope <span class="symbol">:user</span> <span class="keyword">do</span></div><div class="line">    match <span class="string">"/users/auth/shibboleth"</span> =&gt; <span class="string">"omniauth_callbacks#passthru"</span>, <span class="symbol">as:</span> <span class="string">"new_user_session"</span>,       <span class="symbol">via:</span> [<span class="symbol">:get</span>]</div><div class="line">    match <span class="string">"/users/sign_in"</span>         =&gt; <span class="string">"devise/sessions#new"</span>,         <span class="symbol">as:</span> <span class="string">"new_local_user_session"</span>, <span class="symbol">via:</span> [<span class="symbol">:get</span>]</div><div class="line">    match <span class="string">"/users/sign_in"</span>         =&gt; <span class="string">"devise/sessions#create"</span>,      <span class="symbol">as:</span> <span class="string">"user_session"</span>,           <span class="symbol">via:</span> [<span class="symbol">:post</span>]</div><div class="line">    match <span class="string">"/users/sign_out"</span>        =&gt; <span class="string">"devise/sessions#destroy"</span>,     <span class="symbol">as:</span> <span class="string">"destroy_user_session"</span>,   <span class="symbol">via:</span> [<span class="symbol">:get</span>]</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Further to the basic configuration to &lt;a href=&quot;/2017/07/04/configure-shibboleth-service-provider-ubuntu-16/&quot;&gt;make Shibboleth working with
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="rails" scheme="https://www.yuxifan.com/tags/rails/"/>
    
      <category term="shibboleth" scheme="https://www.yuxifan.com/tags/shibboleth/"/>
    
      <category term="passenger" scheme="https://www.yuxifan.com/tags/passenger/"/>
    
  </entry>
  
  <entry>
    <title>Setting up Phusion Passenger with Apache 2.4 on Ubuntu</title>
    <link href="https://www.yuxifan.com/2017/07/07/phusion-passenger/"/>
    <id>https://www.yuxifan.com/2017/07/07/phusion-passenger/</id>
    <published>2017-07-07T08:51:12.000Z</published>
    <updated>2017-07-07T10:55:12.189Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/phusion-passenger.jpg" alt="Phusion Passenger"></p>
<h2 id="Install-Apache-2"><a href="#Install-Apache-2" class="headerlink" title="Install Apache 2"></a>Install Apache 2</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install apache2</div><div class="line">sudo a2enmod headers</div><div class="line">sudo a2enmod expires</div></pre></td></tr></table></figure>
<h2 id="Configure-Apache-SSL"><a href="#Configure-Apache-SSL" class="headerlink" title="Configure Apache SSL"></a>Configure Apache SSL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo a2enmod ssl</div><div class="line">sudo a2ensite default-ssl.conf</div><div class="line">sudo mkdir /etc/apache2/ssl</div><div class="line">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt</div></pre></td></tr></table></figure>
<h2 id="Install-Phusion-Passenger"><a href="#Install-Phusion-Passenger" class="headerlink" title="Install Phusion Passenger"></a>Install Phusion Passenger</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gem install passenger</div><div class="line">passenger-install-apache2-module</div></pre></td></tr></table></figure>
<p>Follow on screen instructions, so the apache configuration file /etc/apache2/apache2.conf looks like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">LoadModule passenger_module /home/yuxi/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/passenger-5.1.5/buildout/apache2/mod_passenger.so</div><div class="line">&lt;IfModule mod_passenger.c&gt;</div><div class="line">     PassengerRoot /home/yuxi/.rbenv/versions/2.3.1/lib/ruby/gems/2.3.0/gems/passenger-5.1.5</div><div class="line">     PassengerDefaultRuby /home/yuxi/.rbenv/versions/2.3.1/bin/ruby</div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure>
<h2 id="Configure-Rails-application-in-Apache-2-x"><a href="#Configure-Rails-application-in-Apache-2-x" class="headerlink" title="Configure Rails application in Apache 2.x"></a>Configure Rails application in Apache 2.x</h2><p>Edit /etc/apache2/sites-enabled/default-ssl.conf:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;IfModule mod_ssl.c&gt;</div><div class="line">  &lt;VirtualHost _default_:443&gt;</div><div class="line">    ServerAdmin info@yuxifan.com</div><div class="line">    ServerName localhost</div><div class="line"></div><div class="line">    SSLEngine on</div><div class="line">    SSLCertificateFile /etc/apache2/ssl/apache.crt</div><div class="line">    SSLCertificateKeyFile /etc/apache2/ssl/apache.key</div><div class="line"></div><div class="line">    RailsEnv production</div><div class="line">    RailsBaseURI /</div><div class="line"></div><div class="line">    Alias / /home/yuxi/rails_app/public</div><div class="line">    &lt;Location /&gt;</div><div class="line">      PassengerBaseURI /</div><div class="line">      PassengerAppRoot /home/yuxi/rails_app</div><div class="line">    &lt;/Location&gt;</div><div class="line">    &lt;Directory /home/yuxi/rails_app/public&gt;</div><div class="line">      Require all granted</div><div class="line">      AllowOverride None</div><div class="line">      Options -MultiViews +FollowSymLinks</div><div class="line">      Require all granted</div><div class="line">    &lt;/Directory&gt;</div><div class="line"></div><div class="line">    &lt;Location /assets/&gt;</div><div class="line">      Require all granted</div><div class="line">      Header <span class="built_in">unset</span> ETag</div><div class="line">      FileETag None</div><div class="line">      ExpiresActive On</div><div class="line">      ExpiresDefault <span class="string">"access plus 1 year"</span></div><div class="line">    &lt;/Location&gt;</div><div class="line">  &lt;/VirtualHost&gt;</div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure>
<h2 id="Configurations-within-Rails-application"><a href="#Configurations-within-Rails-application" class="headerlink" title="Configurations within Rails application"></a>Configurations within Rails application</h2><p>Generate assets for production:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rake assets:precompile RAILS_ENV=production</div></pre></td></tr></table></figure>
<p>Edit config/environments/production.rb, make sure:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">config.public_file_server.enabled = <span class="literal">true</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/phusion-passenger.jpg&quot; alt=&quot;Phusion Passenger&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Install-Apache-2&quot;&gt;&lt;a href=&quot;#Install-Apache-2&quot; class=&quot;h
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ubuntu" scheme="https://www.yuxifan.com/tags/ubuntu/"/>
    
      <category term="Phusion Passenger" scheme="https://www.yuxifan.com/tags/Phusion-Passenger/"/>
    
      <category term="Rails" scheme="https://www.yuxifan.com/tags/Rails/"/>
    
      <category term="Apache" scheme="https://www.yuxifan.com/tags/Apache/"/>
    
  </entry>
  
  <entry>
    <title>Setting up Ruby development environments</title>
    <link href="https://www.yuxifan.com/2017/07/06/setting-up-ruby-development-environments/"/>
    <id>https://www.yuxifan.com/2017/07/06/setting-up-ruby-development-environments/</id>
    <published>2017-07-06T08:51:12.000Z</published>
    <updated>2017-07-07T12:44:32.957Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/ruby.png" alt="Ruby"></p>
<h2 id="Install-development-libraries"><a href="#Install-development-libraries" class="headerlink" title="Install development libraries"></a>Install development libraries</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get -y update</div><div class="line">sudo apt-get -y install build-essential zlib1g-dev libssl-dev libreadline6-dev libyaml-dev</div></pre></td></tr></table></figure>
<h2 id="Install-rbenv"><a href="#Install-rbenv" class="headerlink" title="Install rbenv"></a>Install rbenv</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~</div><div class="line">git <span class="built_in">clone</span> git://github.com/sstephenson/rbenv.git .rbenv                        </div><div class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$HOME/.rbenv/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile</div><div class="line"><span class="built_in">echo</span> <span class="string">'eval "$(rbenv init -)"'</span> &gt;&gt; ~/.bash_profile</div><div class="line">git <span class="built_in">clone</span> git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build</div><div class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$HOME/.rbenv/plugins/ruby-build/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile</div><div class="line"><span class="built_in">source</span> ~/.bash_profile</div></pre></td></tr></table></figure>
<h2 id="Install-ruby"><a href="#Install-ruby" class="headerlink" title="Install ruby"></a>Install ruby</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rbenv install -v 2.3.1</div><div class="line">rbenv global 2.3.1</div><div class="line">ruby -v</div></pre></td></tr></table></figure>
<h2 id="Install-gems"><a href="#Install-gems" class="headerlink" title="Install gems"></a>Install gems</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gem install bundler</div><div class="line">gem install nokogiri</div><div class="line">gem install rails</div><div class="line">rbenv <span class="built_in">rehash</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/ruby.png&quot; alt=&quot;Ruby&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Install-development-libraries&quot;&gt;&lt;a href=&quot;#Install-development-libraries&quot; class=&quot;h
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="Ruby" scheme="https://www.yuxifan.com/tags/Ruby/"/>
    
      <category term="rbenv" scheme="https://www.yuxifan.com/tags/rbenv/"/>
    
  </entry>
  
  <entry>
    <title>Configure Shibboleth Service Provider on Ubuntu 16</title>
    <link href="https://www.yuxifan.com/2017/07/04/configure-shibboleth-service-provider-ubuntu-16/"/>
    <id>https://www.yuxifan.com/2017/07/04/configure-shibboleth-service-provider-ubuntu-16/</id>
    <published>2017-07-04T08:51:12.000Z</published>
    <updated>2017-07-13T15:31:57.631Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/shibboleth.png" alt="Shibboleth"></p>
<h2 id="Environments"><a href="#Environments" class="headerlink" title="Environments"></a>Environments</h2><p>Ubuntu 16<br>Apache 2<br>Shibboleth 2</p>
<h2 id="Get-Apache-ready-for-Shibboleth"><a href="#Get-Apache-ready-for-Shibboleth" class="headerlink" title="Get Apache ready for Shibboleth"></a>Get Apache ready for Shibboleth</h2><p>Make sure Apache is installed, otherwise, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install apache2</div></pre></td></tr></table></figure>
<p>Enable ssl:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo a2enmod ssl</div></pre></td></tr></table></figure>
<p>Activate the SSL Virtual Host:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo a2ensite default-ssl.conf</div></pre></td></tr></table></figure>
<p>Creating a self-signed SSL certificate:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo mkdir /etc/apache2/ssl</div><div class="line">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt</div></pre></td></tr></table></figure>
<h2 id="Add-Shibboleth-protected-application-service-for-testing"><a href="#Add-Shibboleth-protected-application-service-for-testing" class="headerlink" title="Add Shibboleth protected application/service for testing"></a>Add Shibboleth protected application/service for testing</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo mkdir /var/www/myservice</div></pre></td></tr></table></figure>
<p>Create index page:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /var/www/myservice/index.html</div></pre></td></tr></table></figure></p>
<p>Add content to index.html, e.g. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">Shibboleth protected service</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Install-Shibboleth"><a href="#Install-Shibboleth" class="headerlink" title="Install Shibboleth"></a>Install Shibboleth</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libapache2-mod-shib2</div><div class="line">sudo a2enmod auth_basic</div><div class="line">sudo a2enmod shib2</div></pre></td></tr></table></figure>
<p>Set up a Shibboleth certificate: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo shib-keygen -h localhost</div></pre></td></tr></table></figure>
<p>Check certificate:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl x509 -text -noout -<span class="keyword">in</span> /etc/shibboleth/sp-cert.pem</div></pre></td></tr></table></figure>
<p>Edit /etc/shibboleth/shibboleth2.xml. Make sure <strong>backup the original file</strong> before editing!</p>
<p>Actually, by providing the hostname, testshib.org can generate a sample configuration, e.g. shibboleth2.xml for you automatically at:</p>
<p><a href="https://www.testshib.org/configure.html" rel="external nofollow noopener noreferrer" target="_blank">https://www.testshib.org/configure.html</a> </p>
<p>Sample content below:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">SPConfig</span> <span class="attr">xmlns</span>=<span class="string">"urn:mace:shibboleth:2.0:native:sp:config"</span> <span class="attr">xmlns:md</span>=<span class="string">"urn:oasis:names:tc:SAML:2.0:metadata"</span> <span class="attr">clockSkew</span>=<span class="string">"1800"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ApplicationDefaults</span> <span class="attr">entityID</span>=<span class="string">"https://localhost/shibboleth"</span> <span class="attr">REMOTE_USER</span>=<span class="string">"eppn"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Sessions</span> <span class="attr">lifetime</span>=<span class="string">"28800"</span> <span class="attr">timeout</span>=<span class="string">"3600"</span> <span class="attr">checkAddress</span>=<span class="string">"false"</span> <span class="attr">relayState</span>=<span class="string">"ss:mem"</span> <span class="attr">handlerSSL</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">SSO</span> <span class="attr">entityID</span>=<span class="string">"https://idp.testshib.org/idp/shibboleth"</span>&gt;</span> SAML2 SAML1 <span class="tag">&lt;/<span class="name">SSO</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Logout</span>&gt;</span>SAML2 Local<span class="tag">&lt;/<span class="name">Logout</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Handler</span> <span class="attr">type</span>=<span class="string">"MetadataGenerator"</span> <span class="attr">Location</span>=<span class="string">"/Metadata"</span> <span class="attr">signing</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Handler</span> <span class="attr">type</span>=<span class="string">"Status"</span> <span class="attr">Location</span>=<span class="string">"/Status"</span> <span class="attr">acl</span>=<span class="string">"127.0.0.1 ::1"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Handler</span> <span class="attr">type</span>=<span class="string">"Session"</span> <span class="attr">Location</span>=<span class="string">"/Session"</span> <span class="attr">showAttributeValues</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Handler</span> <span class="attr">type</span>=<span class="string">"DiscoveryFeed"</span> <span class="attr">Location</span>=<span class="string">"/DiscoFeed"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">Sessions</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Errors</span> <span class="attr">supportContact</span>=<span class="string">"root@localhost"</span> <span class="attr">logoLocation</span>=<span class="string">"/shibboleth-sp/logo.jpg"</span> <span class="attr">styleSheet</span>=<span class="string">"/shibboleth-sp/main.css"</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">MetadataProvider</span> <span class="attr">type</span>=<span class="string">"XML"</span> <span class="attr">uri</span>=<span class="string">"http://www.testshib.org/metadata/testshib-providers.xml"</span> <span class="attr">backingFilePath</span>=<span class="string">"testshib-two-idp-metadata.xml"</span> <span class="attr">reloadInterval</span>=<span class="string">"180000"</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">AttributeExtractor</span> <span class="attr">type</span>=<span class="string">"XML"</span> <span class="attr">validate</span>=<span class="string">"true"</span> <span class="attr">path</span>=<span class="string">"attribute-map.xml"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">AttributeResolver</span> <span class="attr">type</span>=<span class="string">"Query"</span> <span class="attr">subjectMatch</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">AttributeFilter</span> <span class="attr">type</span>=<span class="string">"XML"</span> <span class="attr">validate</span>=<span class="string">"true"</span> <span class="attr">path</span>=<span class="string">"attribute-policy.xml"</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">CredentialResolver</span> <span class="attr">type</span>=<span class="string">"File"</span> <span class="attr">key</span>=<span class="string">"sp-key.pem"</span> <span class="attr">certificate</span>=<span class="string">"sp-cert.pem"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ApplicationDefaults</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">SecurityPolicyProvider</span> <span class="attr">type</span>=<span class="string">"XML"</span> <span class="attr">validate</span>=<span class="string">"true"</span> <span class="attr">path</span>=<span class="string">"security-policy.xml"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ProtocolProvider</span> <span class="attr">type</span>=<span class="string">"XML"</span> <span class="attr">validate</span>=<span class="string">"true"</span> <span class="attr">reloadChanges</span>=<span class="string">"false"</span> <span class="attr">path</span>=<span class="string">"protocols.xml"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">SPConfig</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Add-protected-service-into-Apache-configuration"><a href="#Add-protected-service-into-Apache-configuration" class="headerlink" title="Add protected service into Apache configuration"></a>Add protected service into Apache configuration</h2><p>Edit /etc/apache2/sites-available/default-ssl.conf with content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;IfModule mod_ssl.c&gt;</div><div class="line">        &lt;VirtualHost _default_:443&gt;</div><div class="line">                ServerAdmin info@yuxifan.com</div><div class="line">                ServerName localhost</div><div class="line">                DocumentRoot /var/www/html</div><div class="line"></div><div class="line">                ErrorLog <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/error.log</div><div class="line">                CustomLog <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/access.log combined</div><div class="line">                SSLEngine on</div><div class="line">                SSLCertificateFile /etc/apache2/ssl/apache.crt</div><div class="line">                SSLCertificateKeyFile /etc/apache2/ssl/apache.key</div><div class="line"></div><div class="line">                &lt;FilesMatch <span class="string">"\.(cgi|shtml|phtml|php)$"</span>&gt;</div><div class="line">                                SSLOptions +StdEnvVars</div><div class="line">                &lt;/FilesMatch&gt;</div><div class="line">                &lt;Directory /usr/lib/cgi-bin&gt;</div><div class="line">                                SSLOptions +StdEnvVars</div><div class="line">                &lt;/Directory&gt;</div><div class="line"></div><div class="line">                BrowserMatch <span class="string">"MSIE [2-6]"</span> \</div><div class="line">                                nokeepalive ssl-unclean-shutdown \</div><div class="line">                                downgrade-1.0 force-response-1.0</div><div class="line">                BrowserMatch <span class="string">"MSIE [17-9]"</span> ssl-unclean-shutdown</div><div class="line"></div><div class="line">               Alias /myservice/ /var/www/myservice/</div><div class="line">              &lt;Location /myservice/&gt;</div><div class="line">                     AuthType shibboleth</div><div class="line">                     ShibRequestSetting requireSession 1</div><div class="line">                     Require valid-user</div><div class="line">              &lt;/Location&gt;</div><div class="line"></div><div class="line">        &lt;/VirtualHost&gt;</div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure>
<h2 id="Start-Shibboleth-service"><a href="#Start-Shibboleth-service" class="headerlink" title="Start Shibboleth service"></a>Start Shibboleth service</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service shibd start</div></pre></td></tr></table></figure>
<p>You may want to enable Shibboleth at startup:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl <span class="built_in">enable</span> shibd</div></pre></td></tr></table></figure>
<p>Test Shibboleth SP:<br><a href="https://localhost/Shibboleth.sso/DiscoFeed" rel="external nofollow noopener noreferrer" target="_blank">https://localhost/Shibboleth.sso/DiscoFeed</a></p>
<p>Download Metadata:<br><a href="https://FQDN/Shibboleth.sso/Metadata" rel="external nofollow noopener noreferrer" target="_blank">https://FQDN/Shibboleth.sso/Metadata</a></p>
<p>NB: Status page may <strong>NOT</strong> work, e.g. <a href="https://localhost/Shibboleth.sso/Status" rel="external nofollow noopener noreferrer" target="_blank">https://localhost/Shibboleth.sso/Status</a> may returns 403 Error.</p>
<p>Now accessing <a href="https://localhost/myservice/" rel="external nofollow noopener noreferrer" target="_blank">https://localhost/myservice/</a> will redirect you to testshib site.</p>
<p>Upload SP metadata on <a href="https://www.testshib.org/register.html" rel="external nofollow noopener noreferrer" target="_blank">https://www.testshib.org/register.html</a></p>
<p>Now you should be redirected to TestShib login page. </p>
<p>Enter the default name/password and you will be redirected back to your secure service page, e.g. /myservice/index.html (/var/www/myservice/index.html)</p>
<h2 id="Further-configuration"><a href="#Further-configuration" class="headerlink" title="Further configuration"></a>Further configuration</h2><p>Allow access only to users from www.XYZ.com (On Apache 2.4)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Location /myservice/&gt;</div><div class="line">        AuthType shibboleth</div><div class="line">        ShibRequestSetting requireSession 1</div><div class="line">        Require shib-attr affiliation ~ ^.+@www\.XYZ\.com$</div><div class="line">&lt;/Location&gt;</div></pre></td></tr></table></figure>
<p>Allow access to specified user</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Location /myservice/&gt;</div><div class="line">        AuthType shibboleth</div><div class="line">        ShibRequestSetting requireSession 1</div><div class="line">        Require user xxxx@XYZ.com</div><div class="line">&lt;/Location&gt;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/shibboleth.png&quot; alt=&quot;Shibboleth&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Environments&quot;&gt;&lt;a href=&quot;#Environments&quot; class=&quot;headerlink&quot; title=&quot;Env
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="ubuntu" scheme="https://www.yuxifan.com/tags/ubuntu/"/>
    
      <category term="shibboleth" scheme="https://www.yuxifan.com/tags/shibboleth/"/>
    
  </entry>
  
  <entry>
    <title>GraphicsMagick</title>
    <link href="https://www.yuxifan.com/2017/06/28/graphicsmagick/"/>
    <id>https://www.yuxifan.com/2017/06/28/graphicsmagick/</id>
    <published>2017-06-28T01:10:12.000Z</published>
    <updated>2017-06-28T10:22:44.373Z</updated>
    
    <content type="html"><![CDATA[<p>GraphicsMagick is originally derived from ImageMagick 5.5.2 as of November 2002 but has been completely independent of the ImageMagick project since then. As states in <a href="http://www.graphicsmagick.org/index.html" rel="external nofollow noopener noreferrer" target="_blank">GraphicsMagick’s website</a>: GraphicsMagick is better than ImageMagick.</p>
<p><img src="/images/linux/graphicsmagick.jpg" alt="GraphicsMagick"></p>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install graphicsmagick</div></pre></td></tr></table></figure>
<h2 id="Identify-images"><a href="#Identify-images" class="headerlink" title="Identify images"></a>Identify images</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm identify filename.jpg</div></pre></td></tr></table></figure>
<p>Identify image height only:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm identify -format %h filename.jpg</div></pre></td></tr></table></figure></p>
<p>Identify image and output filename, size, height, and width:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm identify -format %f/%b/%h/%w filename.jpg</div></pre></td></tr></table></figure></p>
<h2 id="Resize-images"><a href="#Resize-images" class="headerlink" title="Resize images"></a>Resize images</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gm convert -monitor -resize 50% source.jpg target.jpg</div><div class="line">gm convert -monitor -resize 600x source.jpg target.jpg</div></pre></td></tr></table></figure>
<h2 id="Convert"><a href="#Convert" class="headerlink" title="Convert"></a>Convert</h2><p>To convert a multi-page PostScript document to individual FAX pages:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm convert -monochrome document.ps fax:page</div></pre></td></tr></table></figure></p>
<h2 id="Rotating-Images"><a href="#Rotating-Images" class="headerlink" title="Rotating Images"></a>Rotating Images</h2><h3 id="Clockwise-Rotation"><a href="#Clockwise-Rotation" class="headerlink" title="Clockwise Rotation"></a>Clockwise Rotation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm convert -monitor rotate 45 source.jpg target.jpg</div></pre></td></tr></table></figure>
<h3 id="Anti-clockwise-Rotation"><a href="#Anti-clockwise-Rotation" class="headerlink" title="Anti-clockwise Rotation"></a>Anti-clockwise Rotation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm convert -monitor rotate -45 source.jpg target.jpg</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;GraphicsMagick is originally derived from ImageMagick 5.5.2 as of November 2002 but has been completely independent of the ImageMagick pr
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="linux" scheme="https://www.yuxifan.com/tags/linux/"/>
    
      <category term="ImageMagick" scheme="https://www.yuxifan.com/tags/ImageMagick/"/>
    
      <category term="GraphicsMagick" scheme="https://www.yuxifan.com/tags/GraphicsMagick/"/>
    
  </entry>
  
  <entry>
    <title>How to remove ads from Android screen while charging?</title>
    <link href="https://www.yuxifan.com/2017/05/09/how-to-remove-ads-from-android-charging-screen/"/>
    <id>https://www.yuxifan.com/2017/05/09/how-to-remove-ads-from-android-charging-screen/</id>
    <published>2017-05-09T20:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/mobile/android-charging-screen-ads.jpg" alt="Android lock screen ads"></p>
<p>Recently a large number of users have been complaining that while charging their Android phone, instead of just showing date, time, battery status, the screen also shows advertisements. </p>
<p>While googling the solution for it, lots of posts are saying it is caused by some particular APPs and from the list they provided, non of them worked for me. Here is the solution I finially found - so simple!</p>
<p>Just click the dots/gear on the top right corner of the screen, as shown in the screen shot above, then click ‘turn off’. that is it!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/mobile/android-charging-screen-ads.jpg&quot; alt=&quot;Android lock screen ads&quot;&gt;&lt;/p&gt;
&lt;p&gt;Recently a large number of users have bee
    
    </summary>
    
      <category term="mobile" scheme="https://www.yuxifan.com/categories/mobile/"/>
    
    
      <category term="ads" scheme="https://www.yuxifan.com/tags/ads/"/>
    
  </entry>
  
  <entry>
    <title>Install Android Nougat into Samsung Galaxy S5 step by step</title>
    <link href="https://www.yuxifan.com/2017/05/04/install-android-nougat-into-galaxy-s5/"/>
    <id>https://www.yuxifan.com/2017/05/04/install-android-nougat-into-galaxy-s5/</id>
    <published>2017-05-04T20:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/mobile/s5/android-nougat.jpg" alt="Android Nougat"></p>
<h2 id="1-Install-Odin-to-Windows-PC"><a href="#1-Install-Odin-to-Windows-PC" class="headerlink" title="1) Install Odin to Windows PC"></a>1) Install Odin to Windows PC</h2><p>Download Odin from: <a href="http://odindownload.com/SamsungOdin/" rel="external nofollow noopener noreferrer" target="_blank">http://odindownload.com/SamsungOdin/</a></p>
<p>Extract download Odin zip file to Windows PC, then double click app to run it:</p>
<p><img src="/images/mobile/s5/odin.jpg" alt="Install odin"></p>
<h2 id="2-Install-TWRP"><a href="#2-Install-TWRP" class="headerlink" title="2) Install TWRP"></a>2) Install TWRP</h2><p>Download TWRP to your PC from: <a href="https://twrp.me/" rel="external nofollow noopener noreferrer" target="_blank">https://twrp.me/</a></p>
<p><img src="/images/mobile/s5/odin-2.jpg" alt="Install TWRP in odin"></p>
<p>Switch off your phone and press Volume up + Home + Power to Download mode. Connect your phone to PC via USB cable, then Odin should detect your phone. Now press ‘Start’ to flash TWRP to your phone.</p>
<p>Power off your phone. </p>
<h2 id="3-Install-Cyanogenmod-14-1-and-GAPPS-7-1"><a href="#3-Install-Cyanogenmod-14-1-and-GAPPS-7-1" class="headerlink" title="3) Install Cyanogenmod 14.1 and GAPPS 7.1"></a>3) Install Cyanogenmod 14.1 and GAPPS 7.1</h2><p>Download Cyanogenmod(CM) 14.1 from: <a href="http://mirror41.download.highonandroid.com/download/CM14.1/GalaxyS5/" rel="external nofollow noopener noreferrer" target="_blank">http://mirror41.download.highonandroid.com/download/CM14.1/GalaxyS5/</a><br>Download GAPPS 7.1 from: <a href="http://opengapps.org/" rel="external nofollow noopener noreferrer" target="_blank">http://opengapps.org/</a></p>
<p><strong>NB</strong>: I have tried the recommended version of GAPPS, e.g. ‘stock’ but it won’t work in my phone and gives me “Unfortunately, Google Play Services has stopped “ error. When I switched to the minimal version, e.g. ‘pico’, it works fine.</p>
<p>Copy downloaded GAPPS and Cyanogenmod zip files into your phone’s SD card. </p>
<p>Now press Volume up + Home + Power to enter TWRP screen. Then Wipe your phone and install from Cyanogenmod and GAPPS zip files. </p>
<p>Restart your phone and it’s ready to use!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/mobile/s5/android-nougat.jpg&quot; alt=&quot;Android Nougat&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-Install-Odin-to-Windows-PC&quot;&gt;&lt;a href=&quot;#1-Install-Odin-
    
    </summary>
    
      <category term="mobile" scheme="https://www.yuxifan.com/categories/mobile/"/>
    
    
      <category term="odin" scheme="https://www.yuxifan.com/tags/odin/"/>
    
      <category term="twrp" scheme="https://www.yuxifan.com/tags/twrp/"/>
    
      <category term="cyanogenmod" scheme="https://www.yuxifan.com/tags/cyanogenmod/"/>
    
      <category term="gapps" scheme="https://www.yuxifan.com/tags/gapps/"/>
    
      <category term="samsung" scheme="https://www.yuxifan.com/tags/samsung/"/>
    
  </entry>
  
  <entry>
    <title>Host multiple domains in Nginx</title>
    <link href="https://www.yuxifan.com/2017/03/14/suppport-multiple-domains-in-nginx/"/>
    <id>https://www.yuxifan.com/2017/03/14/suppport-multiple-domains-in-nginx/</id>
    <published>2017-03-14T05:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/nginx.jpg" alt="Host multiple domains in Nginx"></p>
<p>By default, Nginx on Ubuntu 16.04 has one server block enabled by default. It is configured to serve documents at /var/www/html.</p>
<p>To serve multiple sites/domains. We need to do the following:</p>
<h2 id="Create-directories"><a href="#Create-directories" class="headerlink" title="Create directories"></a>Create directories</h2><p>We need to create these directories for each of our domains:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo mkdir -p /var/www/DOMAIN-1.com/html</div><div class="line">sudo mkdir -p /var/www/DOMAIN-2.com/html</div><div class="line"></div><div class="line">sudo chown -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /var/www/DOMAIN-1.com/html</div><div class="line">sudo chown -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /var/www/DOMAIN-2.com/html</div></pre></td></tr></table></figure>
<h2 id="Create-Server-Block-Files-for-Each-Domain"><a href="#Create-Server-Block-Files-for-Each-Domain" class="headerlink" title="Create Server Block Files for Each Domain"></a>Create Server Block Files for Each Domain</h2><p>File: /etc/nginx/sites-available/DOMAIN-1.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80;</div><div class="line">        listen [::]:80;</div><div class="line"></div><div class="line">        root /var/www/DOMAIN-1/html;</div><div class="line"></div><div class="line">        index index.html index.htm;</div><div class="line"></div><div class="line">        server_name www.DOMAIN-1.com;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">                try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>File: /etc/nginx/sites-available/DOMAIN-2.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80;</div><div class="line">        listen [::]:80;</div><div class="line"></div><div class="line">        root /var/www/DOMAIN-2/html;</div><div class="line"></div><div class="line">        index index.html index.htm;</div><div class="line"></div><div class="line">        server_name www.DOMAIN-2.com;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">                try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Run:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo ln -s /etc/nginx/sites-available/DOMAIN-1.com /etc/nginx/sites-enabled/</div><div class="line">sudo ln -s /etc/nginx/sites-available/DOMAIN-2.com /etc/nginx/sites-enabled/</div></pre></td></tr></table></figure></p>
<p>In order to avoid a possible hash bucket memory problem while adding additional server names, modify /etc/nginx/nginx.conf. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/nginx/nginx.conf</div></pre></td></tr></table></figure>
<p>Uncomment this line:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">server_names_hash_bucket_size 64;</div></pre></td></tr></table></figure>
<p>Test:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nginx -t</div></pre></td></tr></table></figure></p>
<p>Restart Nginx:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl restart nginx</div></pre></td></tr></table></figure></p>
<h2 id="Add-hosts"><a href="#Add-hosts" class="headerlink" title="Add hosts"></a>Add hosts</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/hosts</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">YOUR_IP www.DOMAIN-1.com</div><div class="line">YOUR_IP www.DOMAIN-2.com</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/nginx.jpg&quot; alt=&quot;Host multiple domains in Nginx&quot;&gt;&lt;/p&gt;
&lt;p&gt;By default, Nginx on Ubuntu 16.04 has one server block en
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="Linux" scheme="https://www.yuxifan.com/tags/Linux/"/>
    
      <category term="Nginx" scheme="https://www.yuxifan.com/tags/Nginx/"/>
    
      <category term="Ubuntu" scheme="https://www.yuxifan.com/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>Install LEMP + Wordpress in Ubuntu 16.04 LTS step by step</title>
    <link href="https://www.yuxifan.com/2017/02/28/install-lemp-and-wordpress-in-ubuntu-16-lts/"/>
    <id>https://www.yuxifan.com/2017/02/28/install-lemp-and-wordpress-in-ubuntu-16-lts/</id>
    <published>2017-02-28T05:51:12.000Z</published>
    <updated>2017-07-25T09:04:58.025Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/lemp-wordpress.jpg" alt="Install LEMP + Wordpress in Ubuntu 16.04 LTS"></p>
<h2 id="User-and-authentications"><a href="#User-and-authentications" class="headerlink" title="User and authentications"></a>User and authentications</h2><h3 id="Create-user"><a href="#Create-user" class="headerlink" title="Create user"></a>Create user</h3><p>Login as root</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">adduser --gecos <span class="string">""</span> yuxi   [OR YOUR_USER_NAME]</div><div class="line">gpasswd -a yuxi sudo</div></pre></td></tr></table></figure>
<p>OR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">usermod -aG sudo yuxi</div></pre></td></tr></table></figure>
<p>Get your public keys ready, e.g. running “ssh-keygen” in Linux machines which will be connecting to your WP server via SSH.</p>
<p>Login as the new user just being created, and type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir ~/.ssh</div><div class="line">chmod 700 ~/.ssh</div><div class="line">touch ~/.ssh/authorized_keys</div><div class="line">chmod 600 ~/.ssh/authorized_keys</div></pre></td></tr></table></figure>
<p>Add your public keys to authorized_keys. It can be done manually or run the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cat &gt;&gt; ~/.ssh/authorized_keys &lt;&lt; EOF</div><div class="line">YOUR_PUBLIC_KEYS</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>Switch to root user and run:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">'YOUR_USER_NAME ALL=(ALL) NOPASSWD: ALL'</span> &gt;&gt; /etc/sudoers</div></pre></td></tr></table></figure></p>
<p>System update:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sudo apt-get -y update  </div><div class="line">sudo apt-get -y upgrade </div><div class="line">```bash</div><div class="line"></div><div class="line">Update user profile</div><div class="line">```bash</div><div class="line"><span class="built_in">echo</span> <span class="string">'export LS_COLORS=$(echo $LS_COLORS | sed "s/di=\(..\);../di=\1;32/") '</span> &gt;&gt; ~/.bashrc</div><div class="line"><span class="built_in">echo</span> <span class="string">"PS1='\\$ '"</span> &gt;&gt; ~/.bashrc</div></pre></td></tr></table></figure></p>
<h3 id="Authentications"><a href="#Authentications" class="headerlink" title="Authentications"></a>Authentications</h3><p>Run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/ssh/sshd_config</div></pre></td></tr></table></figure>
<p>Then make the following changes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">PasswordAuthentication no</div><div class="line">PubkeyAuthentication yes</div><div class="line">ChallengeResponseAuthentication no</div></pre></td></tr></table></figure>
<p>Also, change port from default ‘22’ to other number, e.g. 2244</p>
<p>Reload sshd service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl reload sshd</div></pre></td></tr></table></figure>
<h3 id="Basic-firewall-settings"><a href="#Basic-firewall-settings" class="headerlink" title="Basic firewall settings"></a>Basic firewall settings</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo ufw <span class="built_in">enable</span></div><div class="line">sudo ufw delete allow OpenSSH</div><div class="line">sudo ufw allow from any to any port 2224</div><div class="line">sudo ufw status</div></pre></td></tr></table></figure>
<h2 id="System"><a href="#System" class="headerlink" title="System"></a>System</h2><h3 id="Basic-libraries"><a href="#Basic-libraries" class="headerlink" title="Basic libraries"></a>Basic libraries</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -qq -y curl </div><div class="line">sudo apt-get install -qq -y lynx-cur</div><div class="line">sudo apt-get install -qq -y git</div><div class="line">sudo apt-get install -qq -y whois</div><div class="line">sudo apt-get install -qq -y apache2-utils</div><div class="line">sudo apt-get install -qq -y unzip</div><div class="line">sudo -H -u root bash -c <span class="string">"echo 'Europe/London' &gt; /etc/timezone"</span> </div><div class="line">sudo dpkg-reconfigure -f noninteractive tzdata </div><div class="line">sudo apt-get install -qq -y ntp &gt; /dev/null 2&gt;err.log </div><div class="line"></div><div class="line">git config --global user.email <span class="string">"YOUR_EMAIL"</span></div><div class="line">git config --global user.name  <span class="string">"YOUR NAME"</span></div></pre></td></tr></table></figure>
<h3 id="Swap-space"><a href="#Swap-space" class="headerlink" title="Swap space"></a>Swap space</h3><p>You may want to create a swap space:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo fallocate -l <span class="variable">$SWAP_SPACE_SIZE</span> /swapfile</div><div class="line">sudo chmod 600 /swapfile</div><div class="line">sudo mkswap /swapfile</div><div class="line">sudo swapon /swapfile</div><div class="line">sudo sh -c <span class="string">'echo "/swapfile none swap sw 0 0" &gt;&gt; /etc/fstab'</span></div></pre></td></tr></table></figure>
<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install nginx</div><div class="line">sudo ufw allow <span class="string">'Nginx HTTP'</span></div></pre></td></tr></table></figure>
<p>To find out the IP of VM, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip addr show eth0 | grep inet | awk <span class="string">'&#123; print $2; &#125;'</span> | sed <span class="string">'s/\/.*$//'</span></div></pre></td></tr></table></figure>
<p>Change server_name in Nginx:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano /etc/nginx/sites-enabled/default</div></pre></td></tr></table></figure>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install mysql-server</div><div class="line">sudo mysql_secure_installation</div></pre></td></tr></table></figure>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y php-fpm php-mysql</div></pre></td></tr></table></figure>
<p>Change PHP configuration:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/php/7.0/fpm/php.ini</div></pre></td></tr></table></figure></p>
<p>Change this:<br>cgi.fix_pathinfo=0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl restart php7.0-fpm</div></pre></td></tr></table></figure>
<p>Change Nginx settings to support PHP:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano /etc/nginx/sites-available/default</div></pre></td></tr></table></figure>
<p>With content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80 default_server;</div><div class="line">    listen [::]:80 default_server;</div><div class="line"></div><div class="line">    root /var/www/html;</div><div class="line">    index index.php index.html index.htm index.nginx-debian.html;</div><div class="line"></div><div class="line">    server_name server_domain_or_IP;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        include snippets/fastcgi-php.conf;</div><div class="line">        fastcgi_pass unix:/run/php/php7.0-fpm.sock;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ /\.ht &#123;</div><div class="line">        deny all;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="PHP-Extensions"><a href="#PHP-Extensions" class="headerlink" title="PHP Extensions"></a>PHP Extensions</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get -y update </div><div class="line">sudo apt-get -y install php-curl php-gd php-mbstring php-mcrypt php-xml php-xmlrpc</div><div class="line">sudo systemctl restart php7.0-fpm</div></pre></td></tr></table></figure>
<h2 id="Wordpress"><a href="#Wordpress" class="headerlink" title="Wordpress"></a>Wordpress</h2><p>First, create database for wordpress:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div><div class="line">CREATE DATABASE wordpress DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;</div><div class="line">GRANT ALL ON wordpress.* TO <span class="string">'wordpressuser'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'password'</span>;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line"><span class="built_in">exit</span></div></pre></td></tr></table></figure>
<p>Modify Nginx configuration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">location = /favicon.ico &#123; log_not_found off; access_log off; &#125;</div><div class="line">location = /robots.txt &#123; log_not_found off; access_log off; allow all; &#125;</div><div class="line">location ~* \.(css|gif|ico|jpeg|jpg|js|png)$ &#123;</div><div class="line">  expires max;</div><div class="line">  log_not_found off;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">                try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php<span class="variable">$is_args</span><span class="variable">$args</span>;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>Reload:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl reload nginx</div></pre></td></tr></table></figure>
<p>Install Wordpress</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp</div><div class="line">curl -O https://wordpress.org/latest.tar.gz</div><div class="line">tar xvf latest.tar.gz</div><div class="line">cp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php</div><div class="line">sudo cp -a /tmp/wordpress/. /var/www/html</div><div class="line">mkdir  /var/www/html/wp-content/uploads</div><div class="line">mkdir  /var/www/html/wp-content/upgrade</div></pre></td></tr></table></figure>
<p>Change permissions:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chown -R yuxi:www-data /var/www/html</div></pre></td></tr></table></figure></p>
<p>Next, we will set the setgid bit on each of the directories within the document root. This causes new files created within these directories to inherit the group of the parent directory (which we just set to www-data) instead of the creating user’s primary group.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo find /var/www/html -<span class="built_in">type</span> d -<span class="built_in">exec</span> chmod g+s &#123;&#125; \;</div></pre></td></tr></table></figure></p>
<p>There are a few other fine-grained permissions we’ll adjust. First, we’ll give group write access to the wp-content directory so that the web interface can make theme and plugin changes:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chmod g+w /var/www/html/wp-content</div></pre></td></tr></table></figure></p>
<p>As part of this process, we will give the web server write access to all of the content in these two directories:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo chmod -R g+w /var/www/html/wp-content/themes</div><div class="line">sudo chmod -R g+w /var/www/html/wp-content/plugins</div></pre></td></tr></table></figure>
<p>When we open the file, our first order of business will be to adjust some secret keys to provide some security for our installation. WordPress provides a secure generator for these values so that you do not have to try to come up with good values on your own.</p>
<p>To grab secure values from the WordPress secret key generator, type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -s https://api.wordpress.org/secret-key/1.1/salt/</div></pre></td></tr></table></figure>
<p>Open /var/www/html/wp-config.php,  update these lines with the keys just being generated:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'AUTH_KEY'</span>,         <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'SECURE_AUTH_KEY'</span>,  <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'LOGGED_IN_KEY'</span>,    <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'NONCE_KEY'</span>,        <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'AUTH_SALT'</span>,        <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'SECURE_AUTH_SALT'</span>, <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'LOGGED_IN_SALT'</span>,   <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'NONCE_SALT'</span>,       <span class="string">'put your unique phrase here'</span>);</div></pre></td></tr></table></figure></p>
<p>Config database: change the following lines in /var/www/html/wp-config.php:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'DB_NAME'</span>, <span class="string">'wordpress'</span>);</div><div class="line">define(<span class="string">'DB_USER'</span>, <span class="string">'wordpressuser'</span>);</div><div class="line">define(<span class="string">'DB_PASSWORD'</span>, <span class="string">'password'</span>);</div></pre></td></tr></table></figure>
<p>The other change we need to make is to set the method that WordPress should use to write to the filesystem. Since we’ve given the web server permission to write where it needs to, we can explicitly set the filesystem method to “direct”. Failure to set this with our current settings would result in WordPress prompting for FTP credentials when we perform some actions.</p>
<p>Just after DB settings, add:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'FS_METHOD'</span>, <span class="string">'direct'</span>);</div></pre></td></tr></table></figure></p>
<p>Complete the Installation via Web UI</p>
<h2 id="WP-tool"><a href="#WP-tool" class="headerlink" title="WP tool"></a>WP tool</h2><h3 id="wp-cli"><a href="#wp-cli" class="headerlink" title="wp-cli"></a>wp-cli</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</div><div class="line">chmod +x wp-cli.phar </div><div class="line">sudo mv wp-cli.phar /usr/<span class="built_in">local</span>/bin/wp</div></pre></td></tr></table></figure>
<p>You can install WP if you haven’t done it via Web Admin UI:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wp core install --url=http://ADDRESS --title=<span class="string">""</span> --admin_user= --admin_password= --admin_email=</div><div class="line"></div><div class="line">wp core language install zh_CN</div><div class="line">wp core language activate zh_CN</div><div class="line">wp option <span class="built_in">set</span> blog_public 1</div></pre></td></tr></table></figure></p>
<h3 id="WP-plugins"><a href="#WP-plugins" class="headerlink" title="WP plugins"></a>WP plugins</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/www/html</div><div class="line">wp plugin delete hello</div><div class="line"></div><div class="line">wp plugin install wordfence</div><div class="line">wp plugin activate wordfence</div><div class="line"></div><div class="line">wp plugin install wordpress-seo</div><div class="line">wp plugin activate wordpress-seo</div><div class="line"></div><div class="line">wp plugin install google-sitemap-generator</div><div class="line">wp plugin activate google-sitemap-generator</div><div class="line"></div><div class="line">wp plugin install <span class="built_in">disable</span>-google-fonts</div><div class="line">wp plugin activate <span class="built_in">disable</span>-google-fonts</div><div class="line"></div><div class="line">wp plugin install miniorange-2-factor-authentication</div><div class="line">wp plugin activate miniorange-2-factor-authentication</div><div class="line"></div><div class="line">wp plugin install nofollow-for-external-link</div><div class="line">wp plugin activate nofollow-for-external-link</div><div class="line"></div><div class="line">wp plugin install wp-super-cache</div><div class="line">wp plugin activate wp-super-cache</div><div class="line"></div><div class="line">wp plugin update --all</div></pre></td></tr></table></figure>
<p>Go to web admin UI to configure these plugins</p>
<h3 id="WP-themes"><a href="#WP-themes" class="headerlink" title="WP themes"></a>WP themes</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wp theme delete twentyfifteen</div><div class="line">wp theme delete twentysixteen</div></pre></td></tr></table></figure>
<p>Install your own themes</p>
<h2 id="Backups"><a href="#Backups" class="headerlink" title="Backups"></a>Backups</h2><h3 id="Install-Amazon-command-line-tool"><a href="#Install-Amazon-command-line-tool" class="headerlink" title="Install Amazon command line tool"></a>Install Amazon command line tool</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -qq -y python-pip</div><div class="line">sudo pip install --upgrade pip</div><div class="line">sudo pip install -U setuptools</div><div class="line">sudo pip -q install awscli</div><div class="line">sudo apt-get install -qq -y awscli</div><div class="line"></div><div class="line">mkdir ~/.aws</div><div class="line">nano ~/.aws/credentials</div></pre></td></tr></table></figure>
<p>Content of credentials:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[default]</div><div class="line">aws_access_key_id = </div><div class="line">aws_secret_access_key =</div></pre></td></tr></table></figure>
<p>nano ~/.aws/config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[default]</div><div class="line">region = eu-central-1</div></pre></td></tr></table></figure>
<p>nano ~/scripts/syncbackups.sh</p>
<p>The content of syncbackups.sh is:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">DATE=`date +%Y%m%d`</div><div class="line"></div><div class="line"><span class="built_in">cd</span> /var/www/html</div><div class="line">wp db  <span class="built_in">export</span> ~/backups/db<span class="variable">$DATE</span>.sql</div><div class="line"><span class="built_in">cd</span> ~/backups</div><div class="line">aws s3 sync . s3://YOUR_S3_BUCKET/YOUR_DB_FOLDER_IN_S3</div><div class="line"><span class="built_in">cd</span> /var/www/html/wp-content/uploads</div><div class="line">aws s3 sync . s3://YOUR_S3_BUCKET/YOUR_UPLOAD_FOLDER_IN_S3 --delete</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 700 ~/scripts/syncbackups.sh</div></pre></td></tr></table></figure>
<p>Run crontab -e to add a cron job </p>
<h2 id="Security-settings"><a href="#Security-settings" class="headerlink" title="Security settings"></a>Security settings</h2><h3 id="System-updates"><a href="#System-updates" class="headerlink" title="System updates"></a>System updates</h3><p>nano ~/scripts/systemupdats.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/www/html</div><div class="line">wp plugin update --all</div><div class="line">wp core update</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 700 ~/scripts/systemupdats.sh</div></pre></td></tr></table></figure>
<p>You may want to add it into cron job list</p>
<h3 id="fails2ban"><a href="#fails2ban" class="headerlink" title="fails2ban"></a>fails2ban</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -qq -y fail2ban</div><div class="line">sudo nano /etc/fail2ban/jail.local</div></pre></td></tr></table></figure>
<p>Content of jail.local</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[DEFAULT]</div><div class="line">bantime = 3600</div><div class="line">ignoreip = 127.0.0.1/8 YOUR_IPs</div><div class="line"></div><div class="line">[nginx-http-auth]</div><div class="line">enabled = <span class="literal">true</span></div><div class="line">filter  = nginx-http-auth</div><div class="line">port    = http,https</div><div class="line">logpath = %(nginx_error_log)s</div><div class="line"></div><div class="line">[nginx-badbots]</div><div class="line">enabled  = <span class="literal">true</span></div><div class="line">port     = http,https</div><div class="line">filter   = nginx-badbots</div><div class="line">logpath  = /var/<span class="built_in">log</span>/nginx/access.log</div><div class="line">maxretry = 2</div><div class="line"></div><div class="line">[nginx-noproxy]</div><div class="line">enabled  = <span class="literal">true</span></div><div class="line">port     = http,https</div><div class="line">filter   = nginx-noproxy</div><div class="line">logpath  = /var/<span class="built_in">log</span>/nginx/access.log</div><div class="line">maxretry = 2</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/fail2ban/filter.d/nginx-http-auth.conf</div></pre></td></tr></table></figure>
<p>Update file with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">failregex = ^ \[error\] \d+<span class="comment">#\d+: \*\d+ user "\S+":? (password mismatch|was not found in ".*"), client: &lt;HOST&gt;, server: \S+, request: "\S+ \S+ HTTP/\d+\.\d+", host: "\S+"\s*$</span></div><div class="line">                ^ \[error\] \d+<span class="comment">#\d+: \*\d+ no user/password was provided for basic authentication, client: &lt;HOST&gt;, server: \S+, request: "\S+ \S+ HTTP/\d+\.\d+", host: "\S+"\s*$</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo cp /etc/fail2ban/filter.d/apache-badbots.conf /etc/fail2ban/filter.d/nginx-badbots.conf</div><div class="line"><span class="built_in">cd</span> /etc/fail2ban/filter.d</div><div class="line">sudo nano nginx-nohome.conf</div></pre></td></tr></table></figure>
<p>Content of nginx-nohome.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[Definition]</div><div class="line"></div><div class="line">failregex = ^&lt;HOST&gt; -.*GET .*/~.*</div><div class="line"></div><div class="line">ignoreregex =</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano nginx-noproxy.conf</div></pre></td></tr></table></figure>
<p>Content:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[Definition]</div><div class="line"></div><div class="line">failregex = ^&lt;HOST&gt; -.*GET http.*</div><div class="line"></div><div class="line">ignoreregex =</div></pre></td></tr></table></figure></p>
<p>Run:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service fail2ban restart</div></pre></td></tr></table></figure></p>
<h3 id="Protect-WP-pages-with-basic-auth"><a href="#Protect-WP-pages-with-basic-auth" class="headerlink" title="Protect WP pages with basic auth"></a>Protect WP pages with basic auth</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install apache2-utils</div><div class="line"></div><div class="line">sudo htpasswd -c /etc/nginx/.htpasswd sammy</div><div class="line">sudo htpasswd /etc/nginx/.htpasswd another_user</div><div class="line">cat /etc/nginx/.htpasswd</div></pre></td></tr></table></figure>
<p>sudo nano /etc/nginx/sites-enabled/default</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">location /wp-admin &#123;</div><div class="line">      auth_basic <span class="string">"Restricted"</span>;</div><div class="line">      auth_basic_user_file /etc/nginx/.htpasswd;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location /wp-admin/admin-ajax.php &#123;</div><div class="line">     allow all;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location = /wp-login.php &#123;</div><div class="line">    auth_basic <span class="string">"Restricted"</span>;</div><div class="line">    auth_basic_user_file /etc/nginx/.htpasswd;</div><div class="line">    include fastcgi_params;</div><div class="line">    fastcgi_pass unix:/run/php/php7.0-fpm.sock;</div><div class="line">    fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Disable xml-rpc.php by using plugin:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wp plugin install <span class="built_in">disable</span>-xml-rpc</div><div class="line">wp plugin activate <span class="built_in">disable</span>-xml-rpc</div><div class="line">sudo service nginx restart</div></pre></td></tr></table></figure>
<h3 id="Disable-ping-responses"><a href="#Disable-ping-responses" class="headerlink" title="Disable ping responses"></a>Disable ping responses</h3><p>To temporarily disable ping, under root run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</div></pre></td></tr></table></figure>
<p>To permanently disable ping:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/sysctl.conf</div></pre></td></tr></table></figure>
<p>Then add: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net.ipv4.icmp_echo_ignore_all = 1</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/lemp-wordpress.jpg&quot; alt=&quot;Install LEMP + Wordpress in Ubuntu 16.04 LTS&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;User-and-authentications&quot;&gt;&lt;a 
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="Linux" scheme="https://www.yuxifan.com/tags/Linux/"/>
    
      <category term="Wordpress" scheme="https://www.yuxifan.com/tags/Wordpress/"/>
    
      <category term="LEMP" scheme="https://www.yuxifan.com/tags/LEMP/"/>
    
  </entry>
  
  <entry>
    <title>Config Tomcat session timeout</title>
    <link href="https://www.yuxifan.com/2017/02/23/config-tomcat-session-timeout/"/>
    <id>https://www.yuxifan.com/2017/02/23/config-tomcat-session-timeout/</id>
    <published>2017-02-23T09:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/java/tomcat.png" alt="Where to config Tomcat session timeout"></p>
<p>There are three places to config Tomcat web application session timeout:</p>
<p>$tomcat_home/conf/web.xml<br>$your_webapp/WEB-INF/web.xml<br>manual invocation of HttpSession.setMaxInactiveInterval(int)</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/java/tomcat.png&quot; alt=&quot;Where to config Tomcat session timeout&quot;&gt;&lt;/p&gt;
&lt;p&gt;There are three places to config Tomcat web appli
    
    </summary>
    
      <category term="java" scheme="https://www.yuxifan.com/categories/java/"/>
    
    
      <category term="java" scheme="https://www.yuxifan.com/tags/java/"/>
    
      <category term="Tomcat" scheme="https://www.yuxifan.com/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>Parse Excel spreadsheet in Ruby</title>
    <link href="https://www.yuxifan.com/2017/01/29/parse-excel-spreadsheet-in-ruby/"/>
    <id>https://www.yuxifan.com/2017/01/29/parse-excel-spreadsheet-in-ruby/</id>
    <published>2017-01-29T02:10:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/excel.png" alt="parse excel spreadsheet in Ruby"></p>
<p>First, install this gem: <a href="https://github.com/roo-rb/roo" rel="external nofollow noopener noreferrer" target="_blank">Roo</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install roo</div></pre></td></tr></table></figure>
<p>Then, use classes/methods provided in Roo to access Excel data, e.g. there is my example to iterate Excel spreadsheet data.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># gem install roo</span></div><div class="line"></div><div class="line"><span class="keyword">require</span> <span class="string">'roo'</span></div><div class="line"></div><div class="line">xsl = Roo::Spreadsheet.open(<span class="string">'./test1.xlsx'</span>)</div><div class="line"></div><div class="line">xsl.sheets.each <span class="keyword">do</span> <span class="params">|sheet_name|</span></div><div class="line">  puts <span class="string">''</span></div><div class="line">  puts sheet_name</div><div class="line">  puts <span class="string">'--------------'</span></div><div class="line">  sheet = xsl.sheet(sheet_name)</div><div class="line"></div><div class="line">  <span class="keyword">if</span> !sheet.<span class="literal">nil</span>?</div><div class="line">    last_row    = sheet.last_row</div><div class="line">    last_column = sheet.last_column</div><div class="line"></div><div class="line">    <span class="keyword">if</span> !last_row.<span class="literal">nil</span>? <span class="keyword">and</span> !last_column.<span class="literal">nil</span>?</div><div class="line">      <span class="keyword">for</span> row <span class="keyword">in</span> <span class="number">1</span>..last_row</div><div class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="number">1</span>..last_column</div><div class="line">          v = sheet.cell(row, col)</div><div class="line"></div><div class="line">          <span class="keyword">if</span> v.<span class="literal">nil</span>?</div><div class="line">            puts <span class="string">"NIL"</span></div><div class="line">          <span class="keyword">else</span></div><div class="line">            puts <span class="string">"["</span>+row.to_s+<span class="string">","</span>+col.to_s+<span class="string">"]: "</span> + sheet.cell(row, col)</div><div class="line">          <span class="keyword">end</span></div><div class="line">        <span class="keyword">end</span></div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">      puts <span class="string">'Seems no data in sheet: '</span> + sheet_name</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/excel.png&quot; alt=&quot;parse excel spreadsheet in Ruby&quot;&gt;&lt;/p&gt;
&lt;p&gt;First, install this gem: &lt;a href=&quot;https://github.com/roo-
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="excel" scheme="https://www.yuxifan.com/tags/excel/"/>
    
      <category term="spreadsheet" scheme="https://www.yuxifan.com/tags/spreadsheet/"/>
    
  </entry>
  
  <entry>
    <title>SSL certificate error for rubygems.org and the fix</title>
    <link href="https://www.yuxifan.com/2017/01/27/ssl-certificate-problem-for-ruby-gems-and-solution/"/>
    <id>https://www.yuxifan.com/2017/01/27/ssl-certificate-problem-for-ruby-gems-and-solution/</id>
    <published>2017-01-27T02:10:12.000Z</published>
    <updated>2017-06-28T13:13:12.839Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/ssl.png" alt="SSL Certificate"></p>
<p>While running bundle install in my rails application, I have seen this error message:</p>
<p>Fetching source index from <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a><br>Retrying fetcher due to error (2/4): Bundler::Fetcher::CertificateFailureError Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.<br>Retrying fetcher due to error (3/4): Bundler::Fetcher::CertificateFailureError Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.<br>Retrying fetcher due to error (4/4): Bundler::Fetcher::CertificateFailureError Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.<br>Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect<br>without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.</p>
<p>Here is the solution for this problem:</p>
<h2 id="Update-gem-version"><a href="#Update-gem-version" class="headerlink" title="Update gem version"></a>Update gem version</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/tmp</div><div class="line">wget --no-check-certificate https://rubygems.org/downloads/rubygems-update-2.6.7.gem</div><div class="line">gem install --<span class="built_in">local</span> /var/tmp/rubygems-update-2.6.7.gem</div><div class="line">update_rubygems --no-ri --no-rdoc</div></pre></td></tr></table></figure>
<p>Restart VM and try to run bundle install again.</p>
<h2 id="If-the-above-solution-is-not-working"><a href="#If-the-above-solution-is-not-working" class="headerlink" title="If the above solution is not working"></a>If the above solution is not working</h2><p>If this process does not work for you, you can try manually adding the new certificate.</p>
<h3 id="Step-1-Download-certificate-manually"><a href="#Step-1-Download-certificate-manually" class="headerlink" title="Step 1: Download certificate manually"></a>Step 1: Download certificate manually</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/rubygems/rubygems/master/lib/rubygems/ssl_certs/index.rubygems.org/GlobalSignRootCA.pem -O /var/tmp/GlobalSignRootCA.pem</div></pre></td></tr></table></figure>
<h3 id="Step-2-Locate-RubyGems-certificate-directory-in-your-installation"><a href="#Step-2-Locate-RubyGems-certificate-directory-in-your-installation" class="headerlink" title="Step 2: Locate RubyGems certificate directory in your installation"></a>Step 2: Locate RubyGems certificate directory in your installation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gem <span class="built_in">which</span> rubygems</div><div class="line"><span class="built_in">cd</span> /home/yuxi/.rbenv/versions/2.3.1/lib/ruby/site_ruby/2.3.0/rubygems/ssl_certs/rubygems.org</div><div class="line">cp /var/tmp/GlobalSignRootCA.pem .</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/ssl.png&quot; alt=&quot;SSL Certificate&quot;&gt;&lt;/p&gt;
&lt;p&gt;While running bundle install in my rails application, I have seen this erro
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="gem" scheme="https://www.yuxifan.com/tags/gem/"/>
    
      <category term="ssl" scheme="https://www.yuxifan.com/tags/ssl/"/>
    
  </entry>
  
  <entry>
    <title>Create a shared folder between VirtualBox host and guest</title>
    <link href="https://www.yuxifan.com/2017/01/11/create-shared-folder-in-virtualbox-vm/"/>
    <id>https://www.yuxifan.com/2017/01/11/create-shared-folder-in-virtualbox-vm/</id>
    <published>2017-01-11T09:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/shared-folder.jpg" alt="shared folder in VM"></p>
<p>(1) Configure a shared folder in VM settings</p>
<p>(2) Start VM box</p>
<p>(3) Click “Devices -&gt; Insert Guest Additions CD Image”</p>
<p>(4) Log in to the VM</p>
<p>(5) Mount CD-ROM:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo mount /dev/cdrom /media/cdrom</div><div class="line"><span class="built_in">cd</span> /media/cdrom</div></pre></td></tr></table></figure>
<p>(6) Install dependencies:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y dkms build-essential linux-headers-generic linux-headers-$(uname -r)</div></pre></td></tr></table></figure>
<p>(7)<br>Install Guest Additions</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo su -</div><div class="line">./VBoxLinuxAdditions.run</div></pre></td></tr></table></figure>
<p>(8)<br>Check that kernel extensions are up and running:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo modprobe vboxsf</div></pre></td></tr></table></figure>
<p>If cannot find vboxsf, run following commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/opt/VBoxGuestAdditions-4.3.30/init/vboxadd setup</div><div class="line">sudo apt-get install virtualbox-guest-utils</div><div class="line">sudo apt-get install virtualbox-guest-dkms</div></pre></td></tr></table></figure>
<p>(9) When get vboxsf working,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo mkdir /mnt/rubysrc</div><div class="line">mount -t vboxsf rubysrc /mnt/rubysrc</div></pre></td></tr></table></figure>
<p>(10) To do auto mount, edit /etc/fstab and add:<br>SharedFolder   /mnt/share  vboxsf defaults 0 0</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/shared-folder.jpg&quot; alt=&quot;shared folder in VM&quot;&gt;&lt;/p&gt;
&lt;p&gt;(1) Configure a shared folder in VM settings&lt;/p&gt;
&lt;p&gt;(2) Star
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="virtualbox" scheme="https://www.yuxifan.com/tags/virtualbox/"/>
    
  </entry>
  
  <entry>
    <title>Useful linux commands</title>
    <link href="https://www.yuxifan.com/2017/01/03/useful-linux-commands/"/>
    <id>https://www.yuxifan.com/2017/01/03/useful-linux-commands/</id>
    <published>2017-01-03T05:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/command-line.jpg" alt="Useful linux commands"></p>
<h2 id="Fix-typos-in-the-command-line"><a href="#Fix-typos-in-the-command-line" class="headerlink" title="Fix typos in the command line"></a>Fix typos in the command line</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dp *.txt /var/tmp</div><div class="line">^dp^cp</div></pre></td></tr></table></figure>
<h2 id="Find-commands-that-you-don’t-know"><a href="#Find-commands-that-you-don’t-know" class="headerlink" title="Find commands that you don’t know"></a>Find commands that you don’t know</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apropos <span class="string">"mount file"</span></div></pre></td></tr></table></figure>
<h2 id="Execute-command-from-bash-history"><a href="#Execute-command-from-bash-history" class="headerlink" title="Execute command from bash history"></a>Execute command from bash history</h2><p>Execute the last executed command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!!</div></pre></td></tr></table></figure></p>
<p>Execute the command with all the arguments passed to the previous command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!*</div></pre></td></tr></table></figure></p>
<p>Get the first argument of the last executed command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!ˆ</div></pre></td></tr></table></figure></p>
<p>Get the last argument of the last executed command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!$</div></pre></td></tr></table></figure></p>
<p>Execute the third command in bash history<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!3</div></pre></td></tr></table></figure></p>
<h2 id="Use-comma-and-braces-to-simplify-commands"><a href="#Use-comma-and-braces-to-simplify-commands" class="headerlink" title="Use comma and braces to simplify commands"></a>Use comma and braces to simplify commands</h2><p>Backup system.yaml to system.bak<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp system.yaml&#123;,.bak&#125;</div></pre></td></tr></table></figure></p>
<p>Restore it<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv system.yaml&#123;.bak,&#125;</div></pre></td></tr></table></figure></p>
<p>Copy a file, with target filename with prefix ‘bak’<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp system.yaml bak-!<span class="comment">#^</span></div></pre></td></tr></table></figure></p>
<h2 id="Display-process-tree"><a href="#Display-process-tree" class="headerlink" title="Display process tree"></a>Display process tree</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -aux -forest</div></pre></td></tr></table></figure>
<p>Ncdu - ncurses disk usage analyzer<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install ncdu </div><div class="line">ncdu</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/command-line.jpg&quot; alt=&quot;Useful linux commands&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Fix-typos-in-the-command-line&quot;&gt;&lt;a href=&quot;#Fix-typos-in-
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="linux" scheme="https://www.yuxifan.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Sqlite3 command line</title>
    <link href="https://www.yuxifan.com/2016/12/23/sqlite3-command-line/"/>
    <id>https://www.yuxifan.com/2016/12/23/sqlite3-command-line/</id>
    <published>2016-12-23T02:10:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/database/sqlite.png" alt="sqlite"></p>
<p>To load sqlite3 cli:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlite3 DB_NAME</div></pre></td></tr></table></figure>
<p>List tables:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.tables</div></pre></td></tr></table></figure>
<p>List all table schemas </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">.schema</div><div class="line">.schema TABLE_NAME</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/database/sqlite.png&quot; alt=&quot;sqlite&quot;&gt;&lt;/p&gt;
&lt;p&gt;To load sqlite3 cli:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=
    
    </summary>
    
      <category term="database" scheme="https://www.yuxifan.com/categories/database/"/>
    
    
      <category term="sqlite" scheme="https://www.yuxifan.com/tags/sqlite/"/>
    
  </entry>
  
  <entry>
    <title>Sending and receiving custom domain emails by mailgun and gmail</title>
    <link href="https://www.yuxifan.com/2016/12/14/sending-and-receiving-custom-domain-emails-by-mailgun-and-gmail/"/>
    <id>https://www.yuxifan.com/2016/12/14/sending-and-receiving-custom-domain-emails-by-mailgun-and-gmail/</id>
    <published>2016-12-14T09:51:12.000Z</published>
    <updated>2017-06-28T13:16:21.028Z</updated>
    
    <content type="html"><![CDATA[<p>Setting up a custom domain email address is widely discussed and there are lots of ways to do it, e.g. by using Zoho mail services. However, we have to say the most popular web mail client is Gmail. Gmail is fast, robust and awesome. Here is the way on how to use Mailgun and Gmail to send and receive emails without installing / configuring anything on your server!</p>
<p><img src="/images/linux/mailgun.jpg" alt="Mailgun"></p>
<h2 id="Create-a-mailgun-account"><a href="#Create-a-mailgun-account" class="headerlink" title="Create a mailgun account"></a>Create a mailgun account</h2><p>Register a mailgun account by using your gmail. <strong>Don’t use your custom email account</strong> (you want to create later within Mailgun) as it will cause trouble while validating your Mailgun account.</p>
<p>You may be asked to validating both your email address and a mobile number.</p>
<p>After validation, you will be presented with a dashboard. </p>
<p><img src="/images/linux/mailgun/1.jpg" alt="Mailgun"></p>
<h2 id="Add-a-domain"><a href="#Add-a-domain" class="headerlink" title="Add a domain"></a>Add a domain</h2><p>Now under “Domains”, click “Add New Domain”.</p>
<p>Follow the instructions and set your DNS records with whoever manages your DNS.</p>
<p>Here is my configurations:<br><img src="/images/linux/mailgun/2.jpg" alt="Mailgun"></p>
<h2 id="Create-email-address-under-custom-domain"><a href="#Create-email-address-under-custom-domain" class="headerlink" title="Create email address under custom domain"></a>Create email address under custom domain</h2><p>Click “Manage SMTP Credentials”, then click “New SMTP Credential”. Create your own email address.<br><img src="/images/linux/mailgun/3.jpg" alt="Mailgun"></p>
<h2 id="Add-routes"><a href="#Add-routes" class="headerlink" title="Add routes"></a>Add routes</h2><p>Click on the “Routes” link on the top to set up email forwarding.</p>
<p><img src="/images/linux/mailgun/4.jpg" alt="Mailgun"></p>
<p>The most simple route is to ‘Catch all’ emails to your domain and forward them to your gmail.</p>
<p>Now you can receive emails sending to the custom domain email address. </p>
<h2 id="Sending-within-Gmail"><a href="#Sending-within-Gmail" class="headerlink" title="Sending within Gmail"></a>Sending within Gmail</h2><p>Within Gmail, go to the Accounts tab and click “Add another email address you own”. Once you open this window, enter the email address you wish to send from.</p>
<p><img src="/images/linux/mailgun/5.jpg" alt="Mailgun"></p>
<p>Then click “Add Account”, now you’re done! As shown below, you can send emails from your custom domain email within Gmail!</p>
<p><img src="/images/linux/mailgun/6.jpg" alt="Mailgun"></p>
<p>Enjoy your free email service for up to 10,000 emails a month!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Setting up a custom domain email address is widely discussed and there are lots of ways to do it, e.g. by using Zoho mail services. Howev
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="gmail" scheme="https://www.yuxifan.com/tags/gmail/"/>
    
      <category term="mailgun" scheme="https://www.yuxifan.com/tags/mailgun/"/>
    
  </entry>
  
  <entry>
    <title>Ruby tutorials - rss</title>
    <link href="https://www.yuxifan.com/2016/11/28/ruby-tutorials-rss/"/>
    <id>https://www.yuxifan.com/2016/11/28/ruby-tutorials-rss/</id>
    <published>2016-11-28T02:10:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/rss.png" alt="RSS"></p>
<h2 id="Install-gem"><a href="#Install-gem" class="headerlink" title="Install gem"></a>Install gem</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install feedjira</div></pre></td></tr></table></figure>
<h2 id="Parse-RSS"><a href="#Parse-RSS" class="headerlink" title="Parse RSS"></a>Parse RSS</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'feedjira'</span></div><div class="line"></div><div class="line">feedurl = <span class="string">'https://www.yuxifan.com/atom.xml'</span></div><div class="line"></div><div class="line">feed = Feedjira::Feed.fetch_and_parse feedurl</div><div class="line"></div><div class="line">puts feed.title</div><div class="line">puts feed.url</div><div class="line">puts feed.entries.length</div><div class="line"></div><div class="line">feed.entries.each <span class="keyword">do</span> <span class="params">|item|</span></div><div class="line">  puts item.title</div><div class="line">  puts <span class="string">'------------'</span></div><div class="line">  puts item.url</div><div class="line">  puts <span class="string">' '</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/rss.png&quot; alt=&quot;RSS&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Install-gem&quot;&gt;&lt;a href=&quot;#Install-gem&quot; class=&quot;headerlink&quot; title=&quot;Install gem&quot;&gt;&lt;/a&gt;Ins
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="rss" scheme="https://www.yuxifan.com/tags/rss/"/>
    
  </entry>
  
</feed>
