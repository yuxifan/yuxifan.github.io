<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yuxi Fan</title>
  <subtitle>Yuxi&#39;s development blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.yuxifan.com/"/>
  <updated>2017-06-28T10:22:44.373Z</updated>
  <id>https://www.yuxifan.com/</id>
  
  <author>
    <name>Yuxi</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GraphicsMagick</title>
    <link href="https://www.yuxifan.com/2017/06/28/graphicsmagick/"/>
    <id>https://www.yuxifan.com/2017/06/28/graphicsmagick/</id>
    <published>2017-06-28T01:10:12.000Z</published>
    <updated>2017-06-28T10:22:44.373Z</updated>
    
    <content type="html"><![CDATA[<p>GraphicsMagick is originally derived from ImageMagick 5.5.2 as of November 2002 but has been completely independent of the ImageMagick project since then. As states in <a href="http://www.graphicsmagick.org/index.html" rel="external nofollow noopener noreferrer" target="_blank">GraphicsMagick’s website</a>: GraphicsMagick is better than ImageMagick.</p>
<p><img src="/images/linux/graphicsmagick.jpg" alt="GraphicsMagick"></p>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install graphicsmagick</div></pre></td></tr></table></figure>
<h2 id="Identify-images"><a href="#Identify-images" class="headerlink" title="Identify images"></a>Identify images</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm identify filename.jpg</div></pre></td></tr></table></figure>
<p>Identify image height only:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm identify -format %h filename.jpg</div></pre></td></tr></table></figure></p>
<p>Identify image and output filename, size, height, and width:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm identify -format %f/%b/%h/%w filename.jpg</div></pre></td></tr></table></figure></p>
<h2 id="Resize-images"><a href="#Resize-images" class="headerlink" title="Resize images"></a>Resize images</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gm convert -monitor -resize 50% source.jpg target.jpg</div><div class="line">gm convert -monitor -resize 600x source.jpg target.jpg</div></pre></td></tr></table></figure>
<h2 id="Convert"><a href="#Convert" class="headerlink" title="Convert"></a>Convert</h2><p>To convert a multi-page PostScript document to individual FAX pages:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm convert -monochrome document.ps fax:page</div></pre></td></tr></table></figure></p>
<h2 id="Rotating-Images"><a href="#Rotating-Images" class="headerlink" title="Rotating Images"></a>Rotating Images</h2><h3 id="Clockwise-Rotation"><a href="#Clockwise-Rotation" class="headerlink" title="Clockwise Rotation"></a>Clockwise Rotation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm convert -monitor rotate 45 source.jpg target.jpg</div></pre></td></tr></table></figure>
<h3 id="Anti-clockwise-Rotation"><a href="#Anti-clockwise-Rotation" class="headerlink" title="Anti-clockwise Rotation"></a>Anti-clockwise Rotation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gm convert -monitor rotate -45 source.jpg target.jpg</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;GraphicsMagick is originally derived from ImageMagick 5.5.2 as of November 2002 but has been completely independent of the ImageMagick pr
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="linux" scheme="https://www.yuxifan.com/tags/linux/"/>
    
      <category term="ImageMagick" scheme="https://www.yuxifan.com/tags/ImageMagick/"/>
    
      <category term="GraphicsMagick" scheme="https://www.yuxifan.com/tags/GraphicsMagick/"/>
    
  </entry>
  
  <entry>
    <title>How to remove ads from Android screen while charging?</title>
    <link href="https://www.yuxifan.com/2017/05/09/how-to-remove-ads-from-android-charging-screen/"/>
    <id>https://www.yuxifan.com/2017/05/09/how-to-remove-ads-from-android-charging-screen/</id>
    <published>2017-05-09T20:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/mobile/android-charging-screen-ads.jpg" alt="Android lock screen ads"></p>
<p>Recently a large number of users have been complaining that while charging their Android phone, instead of just showing date, time, battery status, the screen also shows advertisements. </p>
<p>While googling the solution for it, lots of posts are saying it is caused by some particular APPs and from the list they provided, non of them worked for me. Here is the solution I finially found - so simple!</p>
<p>Just click the dots/gear on the top right corner of the screen, as shown in the screen shot above, then click ‘turn off’. that is it!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/mobile/android-charging-screen-ads.jpg&quot; alt=&quot;Android lock screen ads&quot;&gt;&lt;/p&gt;
&lt;p&gt;Recently a large number of users have bee
    
    </summary>
    
      <category term="mobile" scheme="https://www.yuxifan.com/categories/mobile/"/>
    
    
      <category term="ads" scheme="https://www.yuxifan.com/tags/ads/"/>
    
  </entry>
  
  <entry>
    <title>Install Android Nougat into Samsung Galaxy S5 step by step</title>
    <link href="https://www.yuxifan.com/2017/05/04/install-android-nougat-into-galaxy-s5/"/>
    <id>https://www.yuxifan.com/2017/05/04/install-android-nougat-into-galaxy-s5/</id>
    <published>2017-05-04T20:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/mobile/s5/android-nougat.jpg" alt="Android Nougat"></p>
<h2 id="1-Install-Odin-to-Windows-PC"><a href="#1-Install-Odin-to-Windows-PC" class="headerlink" title="1) Install Odin to Windows PC"></a>1) Install Odin to Windows PC</h2><p>Download Odin from: <a href="http://odindownload.com/SamsungOdin/" rel="external nofollow noopener noreferrer" target="_blank">http://odindownload.com/SamsungOdin/</a></p>
<p>Extract download Odin zip file to Windows PC, then double click app to run it:</p>
<p><img src="/images/mobile/s5/odin.jpg" alt="Install odin"></p>
<h2 id="2-Install-TWRP"><a href="#2-Install-TWRP" class="headerlink" title="2) Install TWRP"></a>2) Install TWRP</h2><p>Download TWRP to your PC from: <a href="https://twrp.me/" rel="external nofollow noopener noreferrer" target="_blank">https://twrp.me/</a></p>
<p><img src="/images/mobile/s5/odin-2.jpg" alt="Install TWRP in odin"></p>
<p>Switch off your phone and press Volume up + Home + Power to Download mode. Connect your phone to PC via USB cable, then Odin should detect your phone. Now press ‘Start’ to flash TWRP to your phone.</p>
<p>Power off your phone. </p>
<h2 id="3-Install-Cyanogenmod-14-1-and-GAPPS-7-1"><a href="#3-Install-Cyanogenmod-14-1-and-GAPPS-7-1" class="headerlink" title="3) Install Cyanogenmod 14.1 and GAPPS 7.1"></a>3) Install Cyanogenmod 14.1 and GAPPS 7.1</h2><p>Download Cyanogenmod(CM) 14.1 from: <a href="http://mirror41.download.highonandroid.com/download/CM14.1/GalaxyS5/" rel="external nofollow noopener noreferrer" target="_blank">http://mirror41.download.highonandroid.com/download/CM14.1/GalaxyS5/</a><br>Download GAPPS 7.1 from: <a href="http://opengapps.org/" rel="external nofollow noopener noreferrer" target="_blank">http://opengapps.org/</a></p>
<p><strong>NB</strong>: I have tried the recommended version of GAPPS, e.g. ‘stock’ but it won’t work in my phone and gives me “Unfortunately, Google Play Services has stopped “ error. When I switched to the minimal version, e.g. ‘pico’, it works fine.</p>
<p>Copy downloaded GAPPS and Cyanogenmod zip files into your phone’s SD card. </p>
<p>Now press Volume up + Home + Power to enter TWRP screen. Then Wipe your phone and install from Cyanogenmod and GAPPS zip files. </p>
<p>Restart your phone and it’s ready to use!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/mobile/s5/android-nougat.jpg&quot; alt=&quot;Android Nougat&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-Install-Odin-to-Windows-PC&quot;&gt;&lt;a href=&quot;#1-Install-Odin-
    
    </summary>
    
      <category term="mobile" scheme="https://www.yuxifan.com/categories/mobile/"/>
    
    
      <category term="odin" scheme="https://www.yuxifan.com/tags/odin/"/>
    
      <category term="twrp" scheme="https://www.yuxifan.com/tags/twrp/"/>
    
      <category term="cyanogenmod" scheme="https://www.yuxifan.com/tags/cyanogenmod/"/>
    
      <category term="gapps" scheme="https://www.yuxifan.com/tags/gapps/"/>
    
      <category term="samsung" scheme="https://www.yuxifan.com/tags/samsung/"/>
    
  </entry>
  
  <entry>
    <title>Host multiple domains in Nginx</title>
    <link href="https://www.yuxifan.com/2017/03/14/suppport-multiple-domains-in-nginx/"/>
    <id>https://www.yuxifan.com/2017/03/14/suppport-multiple-domains-in-nginx/</id>
    <published>2017-03-14T05:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/nginx.jpg" alt="Host multiple domains in Nginx"></p>
<p>By default, Nginx on Ubuntu 16.04 has one server block enabled by default. It is configured to serve documents at /var/www/html.</p>
<p>To serve multiple sites/domains. We need to do the following:</p>
<h2 id="Create-directories"><a href="#Create-directories" class="headerlink" title="Create directories"></a>Create directories</h2><p>We need to create these directories for each of our domains:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo mkdir -p /var/www/DOMAIN-1.com/html</div><div class="line">sudo mkdir -p /var/www/DOMAIN-2.com/html</div><div class="line"></div><div class="line">sudo chown -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /var/www/DOMAIN-1.com/html</div><div class="line">sudo chown -R <span class="variable">$USER</span>:<span class="variable">$USER</span> /var/www/DOMAIN-2.com/html</div></pre></td></tr></table></figure>
<h2 id="Create-Server-Block-Files-for-Each-Domain"><a href="#Create-Server-Block-Files-for-Each-Domain" class="headerlink" title="Create Server Block Files for Each Domain"></a>Create Server Block Files for Each Domain</h2><p>File: /etc/nginx/sites-available/DOMAIN-1.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80;</div><div class="line">        listen [::]:80;</div><div class="line"></div><div class="line">        root /var/www/DOMAIN-1/html;</div><div class="line"></div><div class="line">        index index.html index.htm;</div><div class="line"></div><div class="line">        server_name www.DOMAIN-1.com;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">                try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>File: /etc/nginx/sites-available/DOMAIN-2.com</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80;</div><div class="line">        listen [::]:80;</div><div class="line"></div><div class="line">        root /var/www/DOMAIN-2/html;</div><div class="line"></div><div class="line">        index index.html index.htm;</div><div class="line"></div><div class="line">        server_name www.DOMAIN-2.com;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">                try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Run:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo ln -s /etc/nginx/sites-available/DOMAIN-1.com /etc/nginx/sites-enabled/</div><div class="line">sudo ln -s /etc/nginx/sites-available/DOMAIN-2.com /etc/nginx/sites-enabled/</div></pre></td></tr></table></figure></p>
<p>In order to avoid a possible hash bucket memory problem while adding additional server names, modify /etc/nginx/nginx.conf. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/nginx/nginx.conf</div></pre></td></tr></table></figure>
<p>Uncomment this line:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">server_names_hash_bucket_size 64;</div></pre></td></tr></table></figure>
<p>Test:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nginx -t</div></pre></td></tr></table></figure></p>
<p>Restart Nginx:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl restart nginx</div></pre></td></tr></table></figure></p>
<h2 id="Add-hosts"><a href="#Add-hosts" class="headerlink" title="Add hosts"></a>Add hosts</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/hosts</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">YOUR_IP www.DOMAIN-1.com</div><div class="line">YOUR_IP www.DOMAIN-2.com</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/nginx.jpg&quot; alt=&quot;Host multiple domains in Nginx&quot;&gt;&lt;/p&gt;
&lt;p&gt;By default, Nginx on Ubuntu 16.04 has one server block en
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="Linux" scheme="https://www.yuxifan.com/tags/Linux/"/>
    
      <category term="Nginx" scheme="https://www.yuxifan.com/tags/Nginx/"/>
    
      <category term="Ubuntu" scheme="https://www.yuxifan.com/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>Install LEMP + Wordpress in Ubuntu 16.04 LTS step by step</title>
    <link href="https://www.yuxifan.com/2017/02/28/install-lemp-and-wordpress-in-ubuntu-16-lts/"/>
    <id>https://www.yuxifan.com/2017/02/28/install-lemp-and-wordpress-in-ubuntu-16-lts/</id>
    <published>2017-02-28T05:51:12.000Z</published>
    <updated>2017-06-28T13:12:58.871Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/lemp-wordpress.jpg" alt="Install LEMP + Wordpress in Ubuntu 16.04 LTS"></p>
<h2 id="User-and-authentications"><a href="#User-and-authentications" class="headerlink" title="User and authentications"></a>User and authentications</h2><h3 id="Create-user"><a href="#Create-user" class="headerlink" title="Create user"></a>Create user</h3><p>Login as root</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">adduser --gecos <span class="string">""</span> yuxi   [OR YOUR_USER_NAME]</div><div class="line">gpasswd -a yuxi sudo</div></pre></td></tr></table></figure>
<p>OR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">usermod -aG sudo yuxi</div></pre></td></tr></table></figure>
<p>Get your public keys ready, e.g. running “ssh-keygen” in Linux machines which will be connecting to your WP server via SSH.</p>
<p>Login as the new user just being created, and type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir ~/.ssh</div><div class="line">chmod 700 ~/.ssh</div><div class="line">touch ~/.ssh/authorized_keys</div><div class="line">chmod 600 ~/.ssh/authorized_keys</div></pre></td></tr></table></figure>
<p>Add your public keys to authorized_keys. It can be done manually or run the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cat &gt;&gt; ~/.ssh/authorized_keys &lt;&lt; EOF</div><div class="line">YOUR_PUBLIC_KEYS</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p>Switch to root user and run:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">'YOUR_USER_NAME ALL=(ALL) NOPASSWD: ALL'</span> &gt;&gt; /etc/sudoers</div></pre></td></tr></table></figure></p>
<p>System update:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sudo apt-get -y update  </div><div class="line">sudo apt-get -y upgrade </div><div class="line">```bash</div><div class="line"></div><div class="line">Update user profile</div><div class="line">```bash</div><div class="line"><span class="built_in">echo</span> <span class="string">'export LS_COLORS=$(echo $LS_COLORS | sed "s/di=\(..\);../di=\1;32/") '</span> &gt;&gt; ~/.bashrc</div><div class="line"><span class="built_in">echo</span> <span class="string">"PS1='\\$ '"</span> &gt;&gt; ~/.bashrc</div></pre></td></tr></table></figure></p>
<h3 id="Authentications"><a href="#Authentications" class="headerlink" title="Authentications"></a>Authentications</h3><p>Run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/ssh/sshd_config</div><div class="line">```bash</div><div class="line"></div><div class="line">Then make the following changes:</div><div class="line"></div><div class="line">```bash</div><div class="line">PasswordAuthentication no</div><div class="line">PubkeyAuthentication yes</div><div class="line">ChallengeResponseAuthentication no</div></pre></td></tr></table></figure>
<p>Also, change port from default ‘22’ to other number, e.g. 2244</p>
<p>Reload sshd service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl reload sshd</div></pre></td></tr></table></figure>
<h3 id="Basic-firewall-settings"><a href="#Basic-firewall-settings" class="headerlink" title="Basic firewall settings"></a>Basic firewall settings</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo ufw <span class="built_in">enable</span></div><div class="line">sudo ufw delete allow OpenSSH</div><div class="line">sudo ufw allow from any to any port 2224</div><div class="line">sudo ufw status</div></pre></td></tr></table></figure>
<h2 id="System"><a href="#System" class="headerlink" title="System"></a>System</h2><h3 id="Basic-libraries"><a href="#Basic-libraries" class="headerlink" title="Basic libraries"></a>Basic libraries</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -qq -y curl </div><div class="line">sudo apt-get install -qq -y lynx-cur</div><div class="line">sudo apt-get install -qq -y git</div><div class="line">sudo apt-get install -qq -y whois</div><div class="line">sudo apt-get install -qq -y apache2-utils</div><div class="line">sudo apt-get install -qq -y unzip</div><div class="line">sudo -H -u root bash -c <span class="string">"echo 'Europe/London' &gt; /etc/timezone"</span> </div><div class="line">sudo dpkg-reconfigure -f noninteractive tzdata </div><div class="line">sudo apt-get install -qq -y ntp &gt; /dev/null 2&gt;err.log </div><div class="line"></div><div class="line">git config --global user.email <span class="string">"YOUR_EMAIL"</span></div><div class="line">git config --global user.name  <span class="string">"YOUR NAME"</span></div></pre></td></tr></table></figure>
<h3 id="Swap-space"><a href="#Swap-space" class="headerlink" title="Swap space"></a>Swap space</h3><p>You may want to create a swap space:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo fallocate -l <span class="variable">$SWAP_SPACE_SIZE</span> /swapfile</div><div class="line">sudo chmod 600 /swapfile</div><div class="line">sudo mkswap /swapfile</div><div class="line">sudo swapon /swapfile</div><div class="line">sudo sh -c <span class="string">'echo "/swapfile none swap sw 0 0" &gt;&gt; /etc/fstab'</span></div></pre></td></tr></table></figure>
<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install nginx</div><div class="line">sudo ufw allow <span class="string">'Nginx HTTP'</span></div></pre></td></tr></table></figure>
<p>To find out the IP of VM, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip addr show eth0 | grep inet | awk <span class="string">'&#123; print $2; &#125;'</span> | sed <span class="string">'s/\/.*$//'</span></div></pre></td></tr></table></figure>
<p>Change server_name in Nginx:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano /etc/nginx/sites-enabled/default</div></pre></td></tr></table></figure>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install mysql-server</div><div class="line">sudo mysql_secure_installation</div></pre></td></tr></table></figure>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y php-fpm php-mysql</div></pre></td></tr></table></figure>
<p>Change PHP configuration:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/php/7.0/fpm/php.ini</div></pre></td></tr></table></figure></p>
<p>Change this:<br>cgi.fix_pathinfo=0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl restart php7.0-fpm</div></pre></td></tr></table></figure>
<p>Change Nginx settings to support PHP:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano /etc/nginx/sites-available/default</div></pre></td></tr></table></figure>
<p>With content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80 default_server;</div><div class="line">    listen [::]:80 default_server;</div><div class="line"></div><div class="line">    root /var/www/html;</div><div class="line">    index index.php index.html index.htm index.nginx-debian.html;</div><div class="line"></div><div class="line">    server_name server_domain_or_IP;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        include snippets/fastcgi-php.conf;</div><div class="line">        fastcgi_pass unix:/run/php/php7.0-fpm.sock;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ /\.ht &#123;</div><div class="line">        deny all;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="PHP-Extensions"><a href="#PHP-Extensions" class="headerlink" title="PHP Extensions"></a>PHP Extensions</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get -y update </div><div class="line">sudo apt-get -y install php-curl php-gd php-mbstring php-mcrypt php-xml php-xmlrpc</div><div class="line">sudo systemctl restart php7.0-fpm</div></pre></td></tr></table></figure>
<h2 id="Wordpress"><a href="#Wordpress" class="headerlink" title="Wordpress"></a>Wordpress</h2><p>First, create database for wordpress:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div><div class="line">CREATE DATABASE wordpress DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;</div><div class="line">GRANT ALL ON wordpress.* TO <span class="string">'wordpressuser'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'password'</span>;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line"><span class="built_in">exit</span></div></pre></td></tr></table></figure>
<p>Modify Nginx configuration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">location = /favicon.ico &#123; log_not_found off; access_log off; &#125;</div><div class="line">location = /robots.txt &#123; log_not_found off; access_log off; allow all; &#125;</div><div class="line">location ~* \.(css|gif|ico|jpeg|jpg|js|png)$ &#123;</div><div class="line">  expires max;</div><div class="line">  log_not_found off;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">                try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php<span class="variable">$is_args</span><span class="variable">$args</span>;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>Reload:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl reload nginx</div></pre></td></tr></table></figure>
<p>Install Wordpress</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp</div><div class="line">curl -O https://wordpress.org/latest.tar.gz</div><div class="line">tar xvf latest.tar.gz</div><div class="line">cp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php</div><div class="line">sudo cp -a /tmp/wordpress/. /var/www/html</div><div class="line">mkdir  /var/www/html/wp-content/uploads</div><div class="line">mkdir  /var/www/html/wp-content/upgrade</div></pre></td></tr></table></figure>
<p>Change permissions:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chown -R yuxi:www-data /var/www/html</div></pre></td></tr></table></figure></p>
<p>Next, we will set the setgid bit on each of the directories within the document root. This causes new files created within these directories to inherit the group of the parent directory (which we just set to www-data) instead of the creating user’s primary group.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo find /var/www/html -<span class="built_in">type</span> d -<span class="built_in">exec</span> chmod g+s &#123;&#125; \;</div></pre></td></tr></table></figure></p>
<p>There are a few other fine-grained permissions we’ll adjust. First, we’ll give group write access to the wp-content directory so that the web interface can make theme and plugin changes:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chmod g+w /var/www/html/wp-content</div></pre></td></tr></table></figure></p>
<p>As part of this process, we will give the web server write access to all of the content in these two directories:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo chmod -R g+w /var/www/html/wp-content/themes</div><div class="line">sudo chmod -R g+w /var/www/html/wp-content/plugins</div></pre></td></tr></table></figure>
<p>When we open the file, our first order of business will be to adjust some secret keys to provide some security for our installation. WordPress provides a secure generator for these values so that you do not have to try to come up with good values on your own.</p>
<p>To grab secure values from the WordPress secret key generator, type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -s https://api.wordpress.org/secret-key/1.1/salt/</div></pre></td></tr></table></figure>
<p>Open /var/www/html/wp-config.php,  update these lines with the keys just being generated:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'AUTH_KEY'</span>,         <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'SECURE_AUTH_KEY'</span>,  <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'LOGGED_IN_KEY'</span>,    <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'NONCE_KEY'</span>,        <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'AUTH_SALT'</span>,        <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'SECURE_AUTH_SALT'</span>, <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'LOGGED_IN_SALT'</span>,   <span class="string">'put your unique phrase here'</span>);</div><div class="line">define(<span class="string">'NONCE_SALT'</span>,       <span class="string">'put your unique phrase here'</span>);</div></pre></td></tr></table></figure></p>
<p>Config database: change the following lines in /var/www/html/wp-config.php:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'DB_NAME'</span>, <span class="string">'wordpress'</span>);</div><div class="line">define(<span class="string">'DB_USER'</span>, <span class="string">'wordpressuser'</span>);</div><div class="line">define(<span class="string">'DB_PASSWORD'</span>, <span class="string">'password'</span>);</div></pre></td></tr></table></figure>
<p>The other change we need to make is to set the method that WordPress should use to write to the filesystem. Since we’ve given the web server permission to write where it needs to, we can explicitly set the filesystem method to “direct”. Failure to set this with our current settings would result in WordPress prompting for FTP credentials when we perform some actions.</p>
<p>Just after DB settings, add:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'FS_METHOD'</span>, <span class="string">'direct'</span>);</div></pre></td></tr></table></figure></p>
<p>Complete the Installation via Web UI</p>
<h2 id="WP-tool"><a href="#WP-tool" class="headerlink" title="WP tool"></a>WP tool</h2><h3 id="wp-cli"><a href="#wp-cli" class="headerlink" title="wp-cli"></a>wp-cli</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</div><div class="line">chmod +x wp-cli.phar </div><div class="line">sudo mv wp-cli.phar /usr/<span class="built_in">local</span>/bin/wp</div></pre></td></tr></table></figure>
<p>You can install WP if you haven’t done it via Web Admin UI:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wp core install --url=http://ADDRESS --title=<span class="string">""</span> --admin_user= --admin_password= --admin_email=</div><div class="line"></div><div class="line">wp core language install zh_CN</div><div class="line">wp core language activate zh_CN</div><div class="line">wp option <span class="built_in">set</span> blog_public 1</div></pre></td></tr></table></figure></p>
<h3 id="WP-plugins"><a href="#WP-plugins" class="headerlink" title="WP plugins"></a>WP plugins</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/www/html</div><div class="line">wp plugin delete hello</div><div class="line"></div><div class="line">wp plugin install wordfence</div><div class="line">wp plugin activate wordfence</div><div class="line"></div><div class="line">wp plugin install wordpress-seo</div><div class="line">wp plugin activate wordpress-seo</div><div class="line"></div><div class="line">wp plugin install google-sitemap-generator</div><div class="line">wp plugin activate google-sitemap-generator</div><div class="line"></div><div class="line">wp plugin install <span class="built_in">disable</span>-google-fonts</div><div class="line">wp plugin activate <span class="built_in">disable</span>-google-fonts</div><div class="line"></div><div class="line">wp plugin install miniorange-2-factor-authentication</div><div class="line">wp plugin activate miniorange-2-factor-authentication</div><div class="line"></div><div class="line">wp plugin install nofollow-for-external-link</div><div class="line">wp plugin activate nofollow-for-external-link</div><div class="line"></div><div class="line">wp plugin install wp-super-cache</div><div class="line">wp plugin activate wp-super-cache</div><div class="line"></div><div class="line">wp plugin update --all</div></pre></td></tr></table></figure>
<p>Go to web admin UI to configure these plugins</p>
<h3 id="WP-themes"><a href="#WP-themes" class="headerlink" title="WP themes"></a>WP themes</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wp theme delete twentyfifteen</div><div class="line">wp theme delete twentysixteen</div></pre></td></tr></table></figure>
<p>Install your own themes</p>
<h2 id="Backups"><a href="#Backups" class="headerlink" title="Backups"></a>Backups</h2><h3 id="Install-Amazon-command-line-tool"><a href="#Install-Amazon-command-line-tool" class="headerlink" title="Install Amazon command line tool"></a>Install Amazon command line tool</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -qq -y python-pip</div><div class="line">sudo pip install --upgrade pip</div><div class="line">sudo pip install -U setuptools</div><div class="line">sudo pip -q install awscli</div><div class="line">sudo apt-get install -qq -y awscli</div><div class="line"></div><div class="line">mkdir ~/.aws</div><div class="line">nano ~/.aws/credentials</div></pre></td></tr></table></figure>
<p>Content of credentials:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[default]</div><div class="line">aws_access_key_id = </div><div class="line">aws_secret_access_key =</div></pre></td></tr></table></figure>
<p>nano ~/.aws/config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[default]</div><div class="line">region = eu-central-1</div></pre></td></tr></table></figure>
<p>nano ~/scripts/syncbackups.sh</p>
<p>The content of syncbackups.sh is:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">DATE=`date +%Y%m%d`</div><div class="line"></div><div class="line"><span class="built_in">cd</span> /var/www/html</div><div class="line">wp db  <span class="built_in">export</span> ~/backups/db<span class="variable">$DATE</span>.sql</div><div class="line"><span class="built_in">cd</span> ~/backups</div><div class="line">aws s3 sync . s3://YOUR_S3_BUCKET/YOUR_DB_FOLDER_IN_S3</div><div class="line"><span class="built_in">cd</span> /var/www/html/wp-content/uploads</div><div class="line">aws s3 sync . s3://YOUR_S3_BUCKET/YOUR_UPLOAD_FOLDER_IN_S3 --delete</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 700 ~/scripts/syncbackups.sh</div></pre></td></tr></table></figure>
<p>Run crontab -e to add a cron job </p>
<h2 id="Security-settings"><a href="#Security-settings" class="headerlink" title="Security settings"></a>Security settings</h2><h3 id="System-updates"><a href="#System-updates" class="headerlink" title="System updates"></a>System updates</h3><p>nano ~/scripts/systemupdats.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/www/html</div><div class="line">wp plugin update --all</div><div class="line">wp core update</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 700 ~/scripts/systemupdats.sh</div></pre></td></tr></table></figure>
<p>You may want to add it into cron job list</p>
<h3 id="fails2ban"><a href="#fails2ban" class="headerlink" title="fails2ban"></a>fails2ban</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -qq -y fail2ban</div><div class="line">sudo nano /etc/fail2ban/jail.local</div></pre></td></tr></table></figure>
<p>Content of jail.local</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[DEFAULT]</div><div class="line">bantime = 3600</div><div class="line">ignoreip = 127.0.0.1/8 YOUR_IPs</div><div class="line"></div><div class="line">[nginx-http-auth]</div><div class="line">enabled = <span class="literal">true</span></div><div class="line">filter  = nginx-http-auth</div><div class="line">port    = http,https</div><div class="line">logpath = %(nginx_error_log)s</div><div class="line"></div><div class="line">[nginx-badbots]</div><div class="line">enabled  = <span class="literal">true</span></div><div class="line">port     = http,https</div><div class="line">filter   = nginx-badbots</div><div class="line">logpath  = /var/<span class="built_in">log</span>/nginx/access.log</div><div class="line">maxretry = 2</div><div class="line"></div><div class="line">[nginx-noproxy]</div><div class="line">enabled  = <span class="literal">true</span></div><div class="line">port     = http,https</div><div class="line">filter   = nginx-noproxy</div><div class="line">logpath  = /var/<span class="built_in">log</span>/nginx/access.log</div><div class="line">maxretry = 2</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/fail2ban/filter.d/nginx-http-auth.conf</div></pre></td></tr></table></figure>
<p>Update file with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">failregex = ^ \[error\] \d+<span class="comment">#\d+: \*\d+ user "\S+":? (password mismatch|was not found in ".*"), client: &lt;HOST&gt;, server: \S+, request: "\S+ \S+ HTTP/\d+\.\d+", host: "\S+"\s*$</span></div><div class="line">                ^ \[error\] \d+<span class="comment">#\d+: \*\d+ no user/password was provided for basic authentication, client: &lt;HOST&gt;, server: \S+, request: "\S+ \S+ HTTP/\d+\.\d+", host: "\S+"\s*$</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo cp /etc/fail2ban/filter.d/apache-badbots.conf /etc/fail2ban/filter.d/nginx-badbots.conf</div><div class="line"><span class="built_in">cd</span> /etc/fail2ban/filter.d</div><div class="line">sudo nano nginx-nohome.conf</div></pre></td></tr></table></figure>
<p>Content of nginx-nohome.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[Definition]</div><div class="line"></div><div class="line">failregex = ^&lt;HOST&gt; -.*GET .*/~.*</div><div class="line"></div><div class="line">ignoreregex =</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano nginx-noproxy.conf</div></pre></td></tr></table></figure>
<p>Content:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[Definition]</div><div class="line"></div><div class="line">failregex = ^&lt;HOST&gt; -.*GET http.*</div><div class="line"></div><div class="line">ignoreregex =</div></pre></td></tr></table></figure></p>
<p>Run:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service fail2ban restart</div></pre></td></tr></table></figure></p>
<h3 id="Protect-WP-pages-with-basic-auth"><a href="#Protect-WP-pages-with-basic-auth" class="headerlink" title="Protect WP pages with basic auth"></a>Protect WP pages with basic auth</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install apache2-utils</div><div class="line"></div><div class="line">sudo htpasswd -c /etc/nginx/.htpasswd sammy</div><div class="line">sudo htpasswd /etc/nginx/.htpasswd another_user</div><div class="line">cat /etc/nginx/.htpasswd</div></pre></td></tr></table></figure>
<p>sudo nano /etc/nginx/sites-enabled/default</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">location /wp-admin &#123;</div><div class="line">      auth_basic <span class="string">"Restricted"</span>;</div><div class="line">      auth_basic_user_file /etc/nginx/.htpasswd;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location /wp-admin/admin-ajax.php &#123;</div><div class="line">     allow all;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location = /wp-login.php &#123;</div><div class="line">    auth_basic <span class="string">"Restricted"</span>;</div><div class="line">    auth_basic_user_file /etc/nginx/.htpasswd;</div><div class="line">    include fastcgi_params;</div><div class="line">    fastcgi_pass unix:/run/php/php7.0-fpm.sock;</div><div class="line">    fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Disable xml-rpc.php by using plugin:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wp plugin install <span class="built_in">disable</span>-xml-rpc</div><div class="line">wp plugin activate <span class="built_in">disable</span>-xml-rpc</div><div class="line">sudo service nginx restart</div></pre></td></tr></table></figure>
<h3 id="Disable-ping-responses"><a href="#Disable-ping-responses" class="headerlink" title="Disable ping responses"></a>Disable ping responses</h3><p>To temporarily disable ping, under root run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</div></pre></td></tr></table></figure>
<p>To permanently disable ping:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/sysctl.conf</div></pre></td></tr></table></figure>
<p>Then add: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net.ipv4.icmp_echo_ignore_all = 1</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/lemp-wordpress.jpg&quot; alt=&quot;Install LEMP + Wordpress in Ubuntu 16.04 LTS&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;User-and-authentications&quot;&gt;&lt;a 
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="Linux" scheme="https://www.yuxifan.com/tags/Linux/"/>
    
      <category term="Wordpress" scheme="https://www.yuxifan.com/tags/Wordpress/"/>
    
      <category term="LEMP" scheme="https://www.yuxifan.com/tags/LEMP/"/>
    
  </entry>
  
  <entry>
    <title>Config Tomcat session timeout</title>
    <link href="https://www.yuxifan.com/2017/02/23/config-tomcat-session-timeout/"/>
    <id>https://www.yuxifan.com/2017/02/23/config-tomcat-session-timeout/</id>
    <published>2017-02-23T09:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/java/tomcat.png" alt="Where to config Tomcat session timeout"></p>
<p>There are three places to config Tomcat web application session timeout:</p>
<p>$tomcat_home/conf/web.xml<br>$your_webapp/WEB-INF/web.xml<br>manual invocation of HttpSession.setMaxInactiveInterval(int)</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/java/tomcat.png&quot; alt=&quot;Where to config Tomcat session timeout&quot;&gt;&lt;/p&gt;
&lt;p&gt;There are three places to config Tomcat web appli
    
    </summary>
    
      <category term="java" scheme="https://www.yuxifan.com/categories/java/"/>
    
    
      <category term="java" scheme="https://www.yuxifan.com/tags/java/"/>
    
      <category term="Tomcat" scheme="https://www.yuxifan.com/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>Parse Excel spreadsheet in Ruby</title>
    <link href="https://www.yuxifan.com/2017/01/29/parse-excel-spreadsheet-in-ruby/"/>
    <id>https://www.yuxifan.com/2017/01/29/parse-excel-spreadsheet-in-ruby/</id>
    <published>2017-01-29T02:10:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/excel.png" alt="parse excel spreadsheet in Ruby"></p>
<p>First, install this gem: <a href="https://github.com/roo-rb/roo" rel="external nofollow noopener noreferrer" target="_blank">Roo</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install roo</div></pre></td></tr></table></figure>
<p>Then, use classes/methods provided in Roo to access Excel data, e.g. there is my example to iterate Excel spreadsheet data.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># gem install roo</span></div><div class="line"></div><div class="line"><span class="keyword">require</span> <span class="string">'roo'</span></div><div class="line"></div><div class="line">xsl = Roo::Spreadsheet.open(<span class="string">'./test1.xlsx'</span>)</div><div class="line"></div><div class="line">xsl.sheets.each <span class="keyword">do</span> <span class="params">|sheet_name|</span></div><div class="line">  puts <span class="string">''</span></div><div class="line">  puts sheet_name</div><div class="line">  puts <span class="string">'--------------'</span></div><div class="line">  sheet = xsl.sheet(sheet_name)</div><div class="line"></div><div class="line">  <span class="keyword">if</span> !sheet.<span class="literal">nil</span>?</div><div class="line">    last_row    = sheet.last_row</div><div class="line">    last_column = sheet.last_column</div><div class="line"></div><div class="line">    <span class="keyword">if</span> !last_row.<span class="literal">nil</span>? <span class="keyword">and</span> !last_column.<span class="literal">nil</span>?</div><div class="line">      <span class="keyword">for</span> row <span class="keyword">in</span> <span class="number">1</span>..last_row</div><div class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="number">1</span>..last_column</div><div class="line">          v = sheet.cell(row, col)</div><div class="line"></div><div class="line">          <span class="keyword">if</span> v.<span class="literal">nil</span>?</div><div class="line">            puts <span class="string">"NIL"</span></div><div class="line">          <span class="keyword">else</span></div><div class="line">            puts <span class="string">"["</span>+row.to_s+<span class="string">","</span>+col.to_s+<span class="string">"]: "</span> + sheet.cell(row, col)</div><div class="line">          <span class="keyword">end</span></div><div class="line">        <span class="keyword">end</span></div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">      puts <span class="string">'Seems no data in sheet: '</span> + sheet_name</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/excel.png&quot; alt=&quot;parse excel spreadsheet in Ruby&quot;&gt;&lt;/p&gt;
&lt;p&gt;First, install this gem: &lt;a href=&quot;https://github.com/roo-
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="excel" scheme="https://www.yuxifan.com/tags/excel/"/>
    
      <category term="spreadsheet" scheme="https://www.yuxifan.com/tags/spreadsheet/"/>
    
  </entry>
  
  <entry>
    <title>SSL certificate error for rubygems.org and the fix</title>
    <link href="https://www.yuxifan.com/2017/01/27/ssl-certificate-problem-for-ruby-gems-and-solution/"/>
    <id>https://www.yuxifan.com/2017/01/27/ssl-certificate-problem-for-ruby-gems-and-solution/</id>
    <published>2017-01-27T02:10:12.000Z</published>
    <updated>2017-06-28T13:13:12.839Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/ssl.png" alt="SSL Certificate"></p>
<p>While running bundle install in my rails application, I have seen this error message:</p>
<p>Fetching source index from <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a><br>Retrying fetcher due to error (2/4): Bundler::Fetcher::CertificateFailureError Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.<br>Retrying fetcher due to error (3/4): Bundler::Fetcher::CertificateFailureError Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.<br>Retrying fetcher due to error (4/4): Bundler::Fetcher::CertificateFailureError Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.<br>Could not verify the SSL certificate for <a href="https://rubygems.org/" rel="external nofollow noopener noreferrer" target="_blank">https://rubygems.org/</a>.<br>There is a chance you are experiencing a man-in-the-middle attack, but most likely your system doesn’t have the CA certificates needed for verification. For information about OpenSSL certificates, see <a href="http://bit.ly/ruby-ssl" rel="external nofollow noopener noreferrer" target="_blank">http://bit.ly/ruby-ssl</a>. To connect<br>without using SSL, edit your Gemfile sources and change ‘https’ to ‘http’.</p>
<p>Here is the solution for this problem:</p>
<h2 id="Update-gem-version"><a href="#Update-gem-version" class="headerlink" title="Update gem version"></a>Update gem version</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/tmp</div><div class="line">wget --no-check-certificate https://rubygems.org/downloads/rubygems-update-2.6.7.gem</div><div class="line">gem install --<span class="built_in">local</span> /var/tmp/rubygems-update-2.6.7.gem</div><div class="line">update_rubygems --no-ri --no-rdoc</div></pre></td></tr></table></figure>
<p>Restart VM and try to run bundle install again.</p>
<h2 id="If-the-above-solution-is-not-working"><a href="#If-the-above-solution-is-not-working" class="headerlink" title="If the above solution is not working"></a>If the above solution is not working</h2><p>If this process does not work for you, you can try manually adding the new certificate.</p>
<h3 id="Step-1-Download-certificate-manually"><a href="#Step-1-Download-certificate-manually" class="headerlink" title="Step 1: Download certificate manually"></a>Step 1: Download certificate manually</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/rubygems/rubygems/master/lib/rubygems/ssl_certs/index.rubygems.org/GlobalSignRootCA.pem -O /var/tmp/GlobalSignRootCA.pem</div></pre></td></tr></table></figure>
<h3 id="Step-2-Locate-RubyGems-certificate-directory-in-your-installation"><a href="#Step-2-Locate-RubyGems-certificate-directory-in-your-installation" class="headerlink" title="Step 2: Locate RubyGems certificate directory in your installation"></a>Step 2: Locate RubyGems certificate directory in your installation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gem <span class="built_in">which</span> rubygems</div><div class="line"><span class="built_in">cd</span> /home/yuxi/.rbenv/versions/2.3.1/lib/ruby/site_ruby/2.3.0/rubygems/ssl_certs/rubygems.org</div><div class="line">cp /var/tmp/GlobalSignRootCA.pem .</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/ssl.png&quot; alt=&quot;SSL Certificate&quot;&gt;&lt;/p&gt;
&lt;p&gt;While running bundle install in my rails application, I have seen this erro
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="gem" scheme="https://www.yuxifan.com/tags/gem/"/>
    
      <category term="ssl" scheme="https://www.yuxifan.com/tags/ssl/"/>
    
  </entry>
  
  <entry>
    <title>Create a shared folder between VirtualBox host and guest</title>
    <link href="https://www.yuxifan.com/2017/01/11/create-shared-folder-in-virtualbox-vm/"/>
    <id>https://www.yuxifan.com/2017/01/11/create-shared-folder-in-virtualbox-vm/</id>
    <published>2017-01-11T09:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/shared-folder.jpg" alt="shared folder in VM"></p>
<p>(1) Configure a shared folder in VM settings</p>
<p>(2) Start VM box</p>
<p>(3) Click “Devices -&gt; Insert Guest Additions CD Image”</p>
<p>(4) Log in to the VM</p>
<p>(5) Mount CD-ROM:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo mount /dev/cdrom /media/cdrom</div><div class="line"><span class="built_in">cd</span> /media/cdrom</div></pre></td></tr></table></figure>
<p>(6) Install dependencies:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y dkms build-essential linux-headers-generic linux-headers-$(uname -r)</div></pre></td></tr></table></figure>
<p>(7)<br>Install Guest Additions</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo su -</div><div class="line">./VBoxLinuxAdditions.run</div></pre></td></tr></table></figure>
<p>(8)<br>Check that kernel extensions are up and running:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo modprobe vboxsf</div></pre></td></tr></table></figure>
<p>If cannot find vboxsf, run following commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/opt/VBoxGuestAdditions-4.3.30/init/vboxadd setup</div><div class="line">sudo apt-get install virtualbox-guest-utils</div><div class="line">sudo apt-get install virtualbox-guest-dkms</div></pre></td></tr></table></figure>
<p>(9) When get vboxsf working,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo mkdir /mnt/rubysrc</div><div class="line">mount -t vboxsf rubysrc /mnt/rubysrc</div></pre></td></tr></table></figure>
<p>(10) To do auto mount, edit /etc/fstab and add:<br>SharedFolder   /mnt/share  vboxsf defaults 0 0</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/shared-folder.jpg&quot; alt=&quot;shared folder in VM&quot;&gt;&lt;/p&gt;
&lt;p&gt;(1) Configure a shared folder in VM settings&lt;/p&gt;
&lt;p&gt;(2) Star
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="virtualbox" scheme="https://www.yuxifan.com/tags/virtualbox/"/>
    
  </entry>
  
  <entry>
    <title>Useful linux commands</title>
    <link href="https://www.yuxifan.com/2017/01/03/useful-linux-commands/"/>
    <id>https://www.yuxifan.com/2017/01/03/useful-linux-commands/</id>
    <published>2017-01-03T05:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/command-line.jpg" alt="Useful linux commands"></p>
<h2 id="Fix-typos-in-the-command-line"><a href="#Fix-typos-in-the-command-line" class="headerlink" title="Fix typos in the command line"></a>Fix typos in the command line</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dp *.txt /var/tmp</div><div class="line">^dp^cp</div></pre></td></tr></table></figure>
<h2 id="Find-commands-that-you-don’t-know"><a href="#Find-commands-that-you-don’t-know" class="headerlink" title="Find commands that you don’t know"></a>Find commands that you don’t know</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apropos <span class="string">"mount file"</span></div></pre></td></tr></table></figure>
<h2 id="Execute-command-from-bash-history"><a href="#Execute-command-from-bash-history" class="headerlink" title="Execute command from bash history"></a>Execute command from bash history</h2><p>Execute the last executed command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!!</div></pre></td></tr></table></figure></p>
<p>Execute the command with all the arguments passed to the previous command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!*</div></pre></td></tr></table></figure></p>
<p>Get the first argument of the last executed command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!ˆ</div></pre></td></tr></table></figure></p>
<p>Get the last argument of the last executed command<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!$</div></pre></td></tr></table></figure></p>
<p>Execute the third command in bash history<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!3</div></pre></td></tr></table></figure></p>
<h2 id="Use-comma-and-braces-to-simplify-commands"><a href="#Use-comma-and-braces-to-simplify-commands" class="headerlink" title="Use comma and braces to simplify commands"></a>Use comma and braces to simplify commands</h2><p>Backup system.yaml to system.bak<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp system.yaml&#123;,.bak&#125;</div></pre></td></tr></table></figure></p>
<p>Restore it<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv system.yaml&#123;.bak,&#125;</div></pre></td></tr></table></figure></p>
<p>Copy a file, with target filename with prefix ‘bak’<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp system.yaml bak-!<span class="comment">#^</span></div></pre></td></tr></table></figure></p>
<h2 id="Display-process-tree"><a href="#Display-process-tree" class="headerlink" title="Display process tree"></a>Display process tree</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -aux -forest</div></pre></td></tr></table></figure>
<p>Ncdu - ncurses disk usage analyzer<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install ncdu </div><div class="line">ncdu</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/command-line.jpg&quot; alt=&quot;Useful linux commands&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Fix-typos-in-the-command-line&quot;&gt;&lt;a href=&quot;#Fix-typos-in-
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="linux" scheme="https://www.yuxifan.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Sqlite3 command line</title>
    <link href="https://www.yuxifan.com/2016/12/23/sqlite3-command-line/"/>
    <id>https://www.yuxifan.com/2016/12/23/sqlite3-command-line/</id>
    <published>2016-12-23T02:10:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/database/sqlite.png" alt="sqlite"></p>
<p>To load sqlite3 cli:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlite3 DB_NAME</div></pre></td></tr></table></figure>
<p>List tables:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.tables</div></pre></td></tr></table></figure>
<p>List all table schemas </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">.schema</div><div class="line">.schema TABLE_NAME</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/database/sqlite.png&quot; alt=&quot;sqlite&quot;&gt;&lt;/p&gt;
&lt;p&gt;To load sqlite3 cli:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=
    
    </summary>
    
      <category term="database" scheme="https://www.yuxifan.com/categories/database/"/>
    
    
      <category term="sqlite" scheme="https://www.yuxifan.com/tags/sqlite/"/>
    
  </entry>
  
  <entry>
    <title>Sending and receiving custom domain emails by mailgun and gmail</title>
    <link href="https://www.yuxifan.com/2016/12/14/sending-and-receiving-custom-domain-emails-by-mailgun-and-gmail/"/>
    <id>https://www.yuxifan.com/2016/12/14/sending-and-receiving-custom-domain-emails-by-mailgun-and-gmail/</id>
    <published>2016-12-14T09:51:12.000Z</published>
    <updated>2017-06-28T13:16:21.028Z</updated>
    
    <content type="html"><![CDATA[<p>Setting up a custom domain email address is widely discussed and there are lots of ways to do it, e.g. by using Zoho mail services. However, we have to say the most popular web mail client is Gmail. Gmail is fast, robust and awesome. Here is the way on how to use Mailgun and Gmail to send and receive emails without installing / configuring anything on your server!</p>
<p><img src="/images/linux/mailgun.jpg" alt="Mailgun"></p>
<h2 id="Create-a-mailgun-account"><a href="#Create-a-mailgun-account" class="headerlink" title="Create a mailgun account"></a>Create a mailgun account</h2><p>Register a mailgun account by using your gmail. <strong>Don’t use your custom email account</strong> (you want to create later within Mailgun) as it will cause trouble while validating your Mailgun account.</p>
<p>You may be asked to validating both your email address and a mobile number.</p>
<p>After validation, you will be presented with a dashboard. </p>
<p><img src="/images/linux/mailgun/1.jpg" alt="Mailgun"></p>
<h2 id="Add-a-domain"><a href="#Add-a-domain" class="headerlink" title="Add a domain"></a>Add a domain</h2><p>Now under “Domains”, click “Add New Domain”.</p>
<p>Follow the instructions and set your DNS records with whoever manages your DNS.</p>
<p>Here is my configurations:<br><img src="/images/linux/mailgun/2.jpg" alt="Mailgun"></p>
<h2 id="Create-email-address-under-custom-domain"><a href="#Create-email-address-under-custom-domain" class="headerlink" title="Create email address under custom domain"></a>Create email address under custom domain</h2><p>Click “Manage SMTP Credentials”, then click “New SMTP Credential”. Create your own email address.<br><img src="/images/linux/mailgun/3.jpg" alt="Mailgun"></p>
<h2 id="Add-routes"><a href="#Add-routes" class="headerlink" title="Add routes"></a>Add routes</h2><p>Click on the “Routes” link on the top to set up email forwarding.</p>
<p><img src="/images/linux/mailgun/4.jpg" alt="Mailgun"></p>
<p>The most simple route is to ‘Catch all’ emails to your domain and forward them to your gmail.</p>
<p>Now you can receive emails sending to the custom domain email address. </p>
<h2 id="Sending-within-Gmail"><a href="#Sending-within-Gmail" class="headerlink" title="Sending within Gmail"></a>Sending within Gmail</h2><p>Within Gmail, go to the Accounts tab and click “Add another email address you own”. Once you open this window, enter the email address you wish to send from.</p>
<p><img src="/images/linux/mailgun/5.jpg" alt="Mailgun"></p>
<p>Then click “Add Account”, now you’re done! As shown below, you can send emails from your custom domain email within Gmail!</p>
<p><img src="/images/linux/mailgun/6.jpg" alt="Mailgun"></p>
<p>Enjoy your free email service for up to 10,000 emails a month!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Setting up a custom domain email address is widely discussed and there are lots of ways to do it, e.g. by using Zoho mail services. Howev
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="gmail" scheme="https://www.yuxifan.com/tags/gmail/"/>
    
      <category term="mailgun" scheme="https://www.yuxifan.com/tags/mailgun/"/>
    
  </entry>
  
  <entry>
    <title>Ruby tutorials - rss</title>
    <link href="https://www.yuxifan.com/2016/11/28/ruby-tutorials-rss/"/>
    <id>https://www.yuxifan.com/2016/11/28/ruby-tutorials-rss/</id>
    <published>2016-11-28T02:10:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/rss.png" alt="RSS"></p>
<h2 id="Install-gem"><a href="#Install-gem" class="headerlink" title="Install gem"></a>Install gem</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install feedjira</div></pre></td></tr></table></figure>
<h2 id="Parse-RSS"><a href="#Parse-RSS" class="headerlink" title="Parse RSS"></a>Parse RSS</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'feedjira'</span></div><div class="line"></div><div class="line">feedurl = <span class="string">'https://www.yuxifan.com/atom.xml'</span></div><div class="line"></div><div class="line">feed = Feedjira::Feed.fetch_and_parse feedurl</div><div class="line"></div><div class="line">puts feed.title</div><div class="line">puts feed.url</div><div class="line">puts feed.entries.length</div><div class="line"></div><div class="line">feed.entries.each <span class="keyword">do</span> <span class="params">|item|</span></div><div class="line">  puts item.title</div><div class="line">  puts <span class="string">'------------'</span></div><div class="line">  puts item.url</div><div class="line">  puts <span class="string">' '</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/rss.png&quot; alt=&quot;RSS&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Install-gem&quot;&gt;&lt;a href=&quot;#Install-gem&quot; class=&quot;headerlink&quot; title=&quot;Install gem&quot;&gt;&lt;/a&gt;Ins
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="rss" scheme="https://www.yuxifan.com/tags/rss/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu image manipulation commands</title>
    <link href="https://www.yuxifan.com/2016/11/25/image-manipulation-commands-in-ubuntu/"/>
    <id>https://www.yuxifan.com/2016/11/25/image-manipulation-commands-in-ubuntu/</id>
    <published>2016-11-25T05:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/image-tool/imagemagick.jpg" alt="image tool"></p>
<h2 id="Resize-image-and-convert"><a href="#Resize-image-and-convert" class="headerlink" title="Resize image (and convert)"></a>Resize image (and convert)</h2><p>First, install imagemagick:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update </div><div class="line">sudo apt-get install imagemagick --fix-missing</div></pre></td></tr></table></figure>
<p>Image resize command:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">convert source.jpg -resize 200x100 target.jpg</div><div class="line">convert -resize 50% source.jpg target.png</div><div class="line">convert -resize 600x source.jpg target.jpg</div></pre></td></tr></table></figure></p>
<h2 id="Compress-or-Optimize-images"><a href="#Compress-or-Optimize-images" class="headerlink" title="Compress or Optimize images"></a>Compress or Optimize images</h2><p>For JPG images:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install jpegoptim</div><div class="line">jpegoptim test.jpg</div></pre></td></tr></table></figure></p>
<p>For PNG images:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install optipng</div><div class="line">optipng filename.png</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/linux/image-tool/imagemagick.jpg&quot; alt=&quot;image tool&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Resize-image-and-convert&quot;&gt;&lt;a href=&quot;#Resize-image-and-co
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="linux" scheme="https://www.yuxifan.com/tags/linux/"/>
    
      <category term="image" scheme="https://www.yuxifan.com/tags/image/"/>
    
      <category term="imagemagick" scheme="https://www.yuxifan.com/tags/imagemagick/"/>
    
  </entry>
  
  <entry>
    <title>How to check available disk space and email a report in Ruby</title>
    <link href="https://www.yuxifan.com/2016/11/23/report-disk-space-in-ruby/"/>
    <id>https://www.yuxifan.com/2016/11/23/report-disk-space-in-ruby/</id>
    <published>2016-11-23T02:10:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ruby/diskspace.png" alt=""></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># gem install sys-filesystem</span></div><div class="line"><span class="comment"># gem install gmail</span></div><div class="line"></div><div class="line"><span class="keyword">require</span> <span class="string">'sys/filesystem'</span></div><div class="line"><span class="keyword">require</span> <span class="string">'gmail'</span></div><div class="line"></div><div class="line">threshold = <span class="number">9000</span></div><div class="line"></div><div class="line">stat = Sys::Filesystem.stat(<span class="string">"/"</span>)</div><div class="line">mb_available = stat.block_size * stat.blocks_available / <span class="number">1024</span> / <span class="number">1024</span></div><div class="line">mb_s = mb_available.to_s</div><div class="line">gb_s = (mb_available / <span class="number">1024</span>).to_s</div><div class="line">puts <span class="string">'Available space: '</span> + mb_s + <span class="string">' MB / '</span> + gb_s + <span class="string">' GB'</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> mb_available &lt; threshold</div><div class="line">  puts <span class="string">'Sending email ... '</span></div><div class="line">  user = <span class="string">"YOUR GMAIL"</span></div><div class="line">  pass = <span class="string">"PASSWORD"</span></div><div class="line">  gmail = Gmail.connect(user, pass)</div><div class="line">  email = gmail.compose <span class="keyword">do</span></div><div class="line">    to <span class="string">"XXXX@gmail.com"</span></div><div class="line">    subject <span class="string">"Your available disk space"</span></div><div class="line">    body <span class="string">"Space available: "</span> + mb_s + <span class="string">"MB / "</span> + gb_s + <span class="string">"GB"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  email.deliver!</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>You may want to add it into cron job list. </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/ruby/diskspace.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="ubuntu" scheme="https://www.yuxifan.com/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>QR code generator</title>
    <link href="https://www.yuxifan.com/2016/11/17/qrcode-generator/"/>
    <id>https://www.yuxifan.com/2016/11/17/qrcode-generator/</id>
    <published>2016-11-17T06:40:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" media="all" href="/css/foundation.min.css">
<script type="text/javascript" src="/js/qrcode.min.js"></script>

<img src="/images/javascript/how-to-make-qrcode.jpg">

<br>

<div class="row">
  Enter url：<br>
  <input type="text" id="text" value="http://www.yuxifan.com" style="width: 600px; height: 30px;">
  <br>
  <div id="qrcode" style="width:150px; height:150px; margin-top:15px;"></div>
</div> 

<script type="text/javascript">
var qrcode = new QRCode(document.getElementById("qrcode"), {
	width : 150,
	height : 150
});

function makeCode () {		
	var elText = document.getElementById("text");
	
	if (!elText.value) {
		alert("Input a text");
		elText.focus();
		return;
	}
	
	qrcode.makeCode(elText.value);
}

makeCode();

$("#text").
	on("blur", function () {
		makeCode();
	}).
	on("keydown", function (e) {
		if (e.keyCode == 13) {
			makeCode();
		}
});
</script>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; media=&quot;all&quot; href=&quot;/css/foundation.min.css&quot;&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;/js/qrcode.min.js&quot;&gt;&lt;/script&gt;

&lt;img sr
    
    </summary>
    
      <category term="tool" scheme="https://www.yuxifan.com/categories/tool/"/>
    
    
      <category term="QR code" scheme="https://www.yuxifan.com/tags/QR-code/"/>
    
  </entry>
  
  <entry>
    <title>How to implement a distributed Redis message processing system by using Redis / Resque in Rails</title>
    <link href="https://www.yuxifan.com/2016/11/15/implement-a-distributed-redis-message-processing-system-in-rails/"/>
    <id>https://www.yuxifan.com/2016/11/15/implement-a-distributed-redis-message-processing-system-in-rails/</id>
    <published>2016-11-15T09:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p>I’ve written a post introducing how to implement a distributed message processing system in standalone Ruby application. Now I will do the same, but in Rails.</p>
<h2 id="Architecture-design"><a href="#Architecture-design" class="headerlink" title="Architecture design"></a>Architecture design</h2><p><img src="/images/ruby/redis-architecture2.jpg" alt=""></p>
<h2 id="Add-dependencies"><a href="#Add-dependencies" class="headerlink" title="Add dependencies"></a>Add dependencies</h2><p>add it in Gemfile:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem <span class="string">'resque'</span></div></pre></td></tr></table></figure></p>
<p>Also, modify Rakefile:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">"resque"</span></div><div class="line"><span class="keyword">require</span> <span class="string">"resque/tasks"</span></div></pre></td></tr></table></figure></p>
<h2 id="Add-resque-web-admin-UI"><a href="#Add-resque-web-admin-UI" class="headerlink" title="Add resque web admin UI:"></a>Add resque web admin UI:</h2><p>In Gemfile:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem <span class="string">'resque-web'</span>, <span class="symbol">require:</span> <span class="string">'resque_web'</span></div></pre></td></tr></table></figure>
<p>Later you should be able to access it via: <a href="http://SERVER:PORT/resque" rel="external nofollow noopener noreferrer" target="_blank">http://SERVER:PORT/resque</a></p>
<h2 id="Define-a-worker-message-consumer"><a href="#Define-a-worker-message-consumer" class="headerlink" title="Define a worker (message consumer)"></a>Define a worker (message consumer)</h2><p>Add file app/workers/my_worker.rb<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyWorker</span></span></div><div class="line"></div><div class="line">  @queue = <span class="string">"mymessages"</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">perform</span><span class="params">(message)</span></span></div><div class="line">    puts <span class="string">"worker is processing job: <span class="subst">#&#123;message&#125;</span>"</span></div><div class="line">    </div><div class="line">	<span class="comment"># implement your logic here ...</span></div><div class="line">	</div><div class="line">    puts <span class="string">"Successfully processed: <span class="subst">#&#123;message&#125;</span>"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<p>Don’t forget to update Rakefile:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">require_relative <span class="string">"app/workers/my_worker.rb"</span></div></pre></td></tr></table></figure>
<h2 id="Connect-to-your-remote-Redis-server-in-your-Rails-application"><a href="#Connect-to-your-remote-Redis-server-in-your-Rails-application" class="headerlink" title="Connect to your remote Redis server in your Rails application"></a>Connect to your remote Redis server in your Rails application</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RAILS_RESQUE_REDIS=YOUR_REDIS_SERVER_IP:PORT rails s -b0.0.0.0</div></pre></td></tr></table></figure>
<p>If you want to set up a basic HTTP authentication for your Resque web admin UI, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RESQUE_WEB_HTTP_BASIC_AUTH_USER=YOUR_USERNAME RESQUE_WEB_HTTP_BASIC_AUTH_PASSWORD=YOUR_PASSWORD RAILS_RESQUE_REDIS=YOUR_REDIS_SERVER_IP:PORT rails s -b0.0.0.0</div></pre></td></tr></table></figure>
<h2 id="To-load-the-worker"><a href="#To-load-the-worker" class="headerlink" title="To load the worker"></a>To load the worker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RAILS_RESQUE_REDIS=YOUR_REDIS_SERVER_IP:PORT rake environment resque:work QUEUE=*</div></pre></td></tr></table></figure>
<p>Note: there is an additional parameter ‘environment’ which is required by Rails 5 (don’t know why - it just works)</p>
<h2 id="The-client-side-message-producer"><a href="#The-client-side-message-producer" class="headerlink" title="The client side (message producer)"></a>The client side (message producer)</h2><p>First, you need to copy over ‘MyWorker.rb’ to your client application, e.g. the message producer. </p>
<p>In the appropriate class, e.g. controller / actor class, add:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">require_relative <span class="string">'my_worker'</span></div></pre></td></tr></table></figure>
<p>Also, make a call to send message to Redis, which will be consumed by your worker later.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Resque.enqueue(MyWorker, your_message)</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;I’ve written a post introducing how to implement a distributed message processing system in standalone Ruby application. Now I will do th
    
    </summary>
    
      <category term="ruby" scheme="https://www.yuxifan.com/categories/ruby/"/>
    
    
      <category term="ruby" scheme="https://www.yuxifan.com/tags/ruby/"/>
    
      <category term="redis" scheme="https://www.yuxifan.com/tags/redis/"/>
    
      <category term="rails" scheme="https://www.yuxifan.com/tags/rails/"/>
    
  </entry>
  
  <entry>
    <title>Convert between simplified Chinese and traditional Chinese</title>
    <link href="https://www.yuxifan.com/2016/11/15/simplified-chinese-traditional-chinese-converter/"/>
    <id>https://www.yuxifan.com/2016/11/15/simplified-chinese-traditional-chinese-converter/</id>
    <published>2016-11-15T06:40:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" media="all" href="/css/foundation.min.css">
<script src="/js/gb-big5.js"></script>
<script src="/js/foundation.min.js"></script>

<img src="/images/javascript/gb-big5.jpg"><br>

<div class="row">
  <div class="large-10 large-offset-1">
      <div class="row">
        <div class="medium-4 columns">
          <label>From:
            <select id="source_lang">
              <option value="zh_TW">Traditional Chinese</option>
              <option value="zh_CN">Simplified Chinese</option>
            </select>
          </label>
        </div>
        <div class="medium-4 columns">
          <label>To:
            <select id="tar_lang">
              <option value="zh_CN">Simplified Chinese</option>
              <option value="zh_TW">Traditional Chinese</option>
            </select>
          </label>
        </div>
        <div class="medium-4 columns">
          <button class="button" id="trans">Convert</button>
        </div>
          
        </div>
	  Enter text to convert：
      <textarea id="content" style="width: 600px; height:200px;"></textarea>
	  
      <br>
      Result：
      <textarea id="res_content" style="width: 600px; height:200px;"></textarea>
  </div>
	  <div style="display:none;">
        Source language encoding：
        <textarea id="source_encode"></textarea>
        Target language encoding：
        <textarea id="tar_encode"></textarea>
	  </div>
  </div>  
<script>
  Trans.init(); 
</script> 
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; media=&quot;all&quot; href=&quot;/css/foundation.min.css&quot;&gt;
&lt;script src=&quot;/js/gb-big5.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/js/foundation.min.js
    
    </summary>
    
      <category term="tool" scheme="https://www.yuxifan.com/categories/tool/"/>
    
    
      <category term="Chinese converter" scheme="https://www.yuxifan.com/tags/Chinese-converter/"/>
    
  </entry>
  
  <entry>
    <title>How to trigger a cron job based on file modifications</title>
    <link href="https://www.yuxifan.com/2016/11/14/how-to-trigger-a-cron-job-based-on-file-modifications/"/>
    <id>https://www.yuxifan.com/2016/11/14/how-to-trigger-a-cron-job-based-on-file-modifications/</id>
    <published>2016-11-14T06:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p>Cron is an amazon tool that allowing Linux and Unix users to run commands or scripts at a given date and time. However, sometimes people want to trigger a job based on file modifications / creations. Here we can use incron to do this kinds of automation.</p>
<p><img src="/images/linux/incron.png" alt="incron"></p>
<h2 id="Incron-installation"><a href="#Incron-installation" class="headerlink" title="Incron installation"></a>Incron installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install incron</div></pre></td></tr></table></figure>
<h2 id="Using-Incron"><a href="#Using-Incron" class="headerlink" title="Using Incron"></a>Using Incron</h2><p>If /etc/incron.allow exists only users listed here may use incron. Otherwise if /etc/incron.deny exists only users NOT listed here may use incron. If none of these files exists everyone is allowed to use incron.</p>
<p>So firstly, we need to modify incron.allow to add users in:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano incron.allow</div></pre></td></tr></table></figure>
<p>Add users e.g. root, yuxi into the list:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root</div><div class="line">yuxi</div></pre></td></tr></table></figure>
<p>Now we can list all incron jobs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">incrontab -l</div></pre></td></tr></table></figure>
<p>Set up incron job for user ‘yuxi’</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">incrontab -e</div></pre></td></tr></table></figure>
<p>Add the following line to do an auto deployment to git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/home/yuxi/website_src/ IN_MODIFY /home/yuxi/deploy_website.sh</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Cron is an amazon tool that allowing Linux and Unix users to run commands or scripts at a given date and time. However, sometimes people 
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="linux" scheme="https://www.yuxifan.com/tags/linux/"/>
    
      <category term="incron" scheme="https://www.yuxifan.com/tags/incron/"/>
    
  </entry>
  
  <entry>
    <title>Upload files to Dropbox in Linux command line</title>
    <link href="https://www.yuxifan.com/2016/11/09/how-to-upload-files-to-dropbox-in-linux-command-line/"/>
    <id>https://www.yuxifan.com/2016/11/09/how-to-upload-files-to-dropbox-in-linux-command-line/</id>
    <published>2016-11-09T09:51:12.000Z</published>
    <updated>2017-06-16T10:17:52.230Z</updated>
    
    <content type="html"><![CDATA[<p>Here is the instruction on how to upload files to your Dropbox without installing Dropbox:</p>
<p><img src="/images/windows/dropbox.png" alt=""></p>
<p>1) First, install the amazing <a href="https://github.com/andreafabrizi/Dropbox-Uploader" rel="external nofollow noopener noreferrer" target="_blank">Dropbox Uploader script</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/andreafabrizi/Dropbox-Uploader.git</div></pre></td></tr></table></figure></p>
<p>2) Open the following URL in your Browser, and log in using your account: <a href="https://www.dropbox.com/developers/apps" rel="external nofollow noopener noreferrer" target="_blank">https://www.dropbox.com/developers/apps</a></p>
<p>3) Click on “Create App”, then select “Dropbox API app”</p>
<p>4) As shown below, configure your dropbox app, choosing the app permissions and access restrictions to your DropBox folder”<br><img src="/images/linux/dropbox-app-conf.jpg" alt=""></p>
<p>5) Enter the “App Name” you like, e.g. YuxiUploader</p>
<p>6) Click on the “Create App” button</p>
<p>7) When your new App is successfully created, click on the Generate button. under the ‘Generated access token’ section, then copy and paste the new access token here to your Linux command line.</p>
<p>8) Now you are ready to upload files to your dropbox, e.g. </p>
<p>Upload file:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./dropbox_uploader.sh upload YOUR_LOCAL_FILE_NAME /</div></pre></td></tr></table></figure></p>
<p>List files:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./dropbox_uploader.sh list</div><div class="line">./dropbox_uploader.sh list subfolder</div></pre></td></tr></table></figure></p>
<p>Download file:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./dropbox_uploader.sh download subfolder/1.pdf ./1.pdf</div></pre></td></tr></table></figure></p>
<p>Create a remote folder:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./dropbox_uploader.sh mkdir /subfolder</div></pre></td></tr></table></figure></p>
<p>Delete a remote folder<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./dropbox_uploader.sh delete /subfolder</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Here is the instruction on how to upload files to your Dropbox without installing Dropbox:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/windows/dropbox.png&quot; 
    
    </summary>
    
      <category term="linux" scheme="https://www.yuxifan.com/categories/linux/"/>
    
    
      <category term="dropbox" scheme="https://www.yuxifan.com/tags/dropbox/"/>
    
      <category term="linux" scheme="https://www.yuxifan.com/tags/linux/"/>
    
  </entry>
  
</feed>
