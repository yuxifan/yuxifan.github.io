<!DOCTYPE html><html><head><meta charset=utf-8><title>How to send a vultr account balance report in Ruby | Yuxi Fan</title><meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1"><meta name=keywords content=ruby,vultr><meta name=description content="Vultr is a great VPS provider. I have a couple of VMs hosted in Vultr. However, according to Vultr T&amp;amp;C: “Failure to make payment of Fees for Services when due may result in the suspension or term"><meta property=og:type content=article><meta property=og:title content="How to send a vultr account balance report in Ruby"><meta property=og:url content=https://www.yuxifan.com/2016/10/12/vultr-account-balance-report-in-ruby/index.html><meta property=og:site_name content="Yuxi Fan"><meta property=og:description content="Vultr is a great VPS provider. I have a couple of VMs hosted in Vultr. However, according to Vultr T&amp;amp;C: “Failure to make payment of Fees for Services when due may result in the suspension or term"><meta property=og:image content=https://www.yuxifan.com/images/ruby/vultr-credit.png><meta property=og:updated_time content=2016-10-12T09:27:43.000Z><meta name=twitter:card content=summary><meta name=twitter:title content="How to send a vultr account balance report in Ruby"><meta name=twitter:description content="Vultr is a great VPS provider. I have a couple of VMs hosted in Vultr. However, according to Vultr T&amp;amp;C: “Failure to make payment of Fees for Services when due may result in the suspension or term"><meta name=twitter:image content=https://www.yuxifan.com/images/ruby/vultr-credit.png><link rel=alternate href=/atom.xml title="Yuxi Fan" type=application/atom+xml><link rel=icon href=/favicon.ico><link rel=stylesheet href=/js/font-awesome/css/font-awesome.min.css><link rel=stylesheet href=/js/titillium-web/styles.css><link rel=stylesheet href=/js/source-code-pro/styles.css><link rel=stylesheet href=/css/style.css><script src=/js/jquery/2.0.3/jquery.min.js></script><link rel=stylesheet href=/js/lightgallery/css/lightgallery.min.css><script type=text/javascript>(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-67297895-9', 'auto');
ga('send', 'pageview');</script><body><div id=wrap><header id=header><div id=header-outer class=outer><div class=container><div class=container-inner><div id=header-title><h1 class=logo-wrap><a href="/" class=logo></a></h1><h2 class=subtitle-wrap><p class=subtitle>Yuxi Fan - Yuxi&#39;s development blog</p></h2></div><div id=header-inner class=nav-container><a id=main-nav-toggle class="nav-icon fa fa-bars"></a><div class=nav-container-inner><ul id=main-nav><li class=main-nav-list-item><a class=main-nav-list-link href="/">home</a></li><ul class=main-nav-list><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/css/">css</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/database/">database</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/git/">git</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/hexo/">hexo</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/java/">java</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/javascript/">javascript</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/jekyll/">jekyll</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/linux/">linux</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/ruby/">ruby</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/solr/">solr</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/tool/">tool</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/windows/">windows</a></li><li class=main-nav-list-item><a class=main-nav-list-link href="/categories/xslt/">xslt</a></li></ul></ul><nav id=sub-nav><div id=search-form-wrap><form class=search-form><input class="ins-search-input search-form-input" placeholder=Search><button type=submit class=search-form-submit></button></form><div class=ins-search><div class=ins-search-mask></div><div class=ins-search-container><div class=ins-input-wrapper><input class=ins-search-input placeholder="Type something..."><span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class=ins-section-wrapper><div class=ins-section-container></div></div></div></div><script>(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script><script src=/js/insight.js></script></div></nav></div></div></div></div></div></header><div class=container><div class="main-body container-inner"><div class=main-body-inner><section id=main><div class=main-body-header><h1 class=header><a class=page-title-link href="/categories/ruby/">ruby</a></h1></div><div class=main-body-content><article id=post-vultr-account-balance-report-in-ruby class="article article-single article-type-post" itemscope itemprop=blogPost><div class=article-inner><header class=article-header><h1 class=article-title itemprop=name>How to send a vultr account balance report in Ruby</h1></header><div class=article-subtitle><a href="/2016/10/12/vultr-account-balance-report-in-ruby/" class=article-date><time datetime=2016-10-12T01:10:12.000Z itemprop=datePublished>2016-10-12</time></a><ul class=article-tag-list><li class=article-tag-list-item><a class=article-tag-list-link href="/tags/ruby/">ruby</a></li><li class=article-tag-list-item><a class=article-tag-list-link href="/tags/vultr/">vultr</a></li></ul></div><div class=article-entry itemprop=articleBody><p><img src=/images/ruby/vultr-credit.png alt="Vultr balance"></p><p><a href="https://www.vultr.com/?ref=6856003" rel="external nofollow" target=_blank>Vultr</a> is a great VPS provider. I have a couple of VMs hosted in Vultr. However, according to Vultr T&amp;C: “Failure to make payment of Fees for Services when due may result in the suspension or termination of Services.” It would be nice to have an alert when the Vultr account balance reaches a threshold. Here is the implementation in Ruby.</p><p>I prefer to have a monthly report no matter if the threshold has been reached. However, if you want to have an email alert when the threshold is reached, the following code can be easily modified to do that.</p><h2 id=Install-gems><a href=#Install-gems class=headerlink title="Install gems"></a>Install gems</h2><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div></pre><td class=code><pre><div class=line>gem install faraday</div><div class=line>gem install json</div><div class=line>gem install gmail</div></pre></table></figure><h2 id=The-Ruby-code><a href=#The-Ruby-code class=headerlink title="The Ruby code"></a>The Ruby code</h2><figure class="highlight ruby"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div><div class=line>20</div><div class=line>21</div><div class=line>22</div><div class=line>23</div><div class=line>24</div><div class=line>25</div><div class=line>26</div><div class=line>27</div><div class=line>28</div><div class=line>29</div></pre><td class=code><pre><div class=line><span class=keyword>require</span> <span class=string>'faraday'</span></div><div class=line><span class=keyword>require</span> <span class=string>'json'</span></div><div class=line><span class=keyword>require</span> <span class=string>'gmail'</span></div><div class=line></div><div class=line>conn = Faraday.new(<span class=symbol>:url</span> =&gt; <span class=string>'https://api.vultr.com'</span>) <span class=keyword>do</span> <span class=params>|c|</span></div><div class=line>  c.use Faraday::Request::UrlEncoded</div><div class=line>  c.use Faraday::Adapter::NetHttp</div><div class=line><span class=keyword>end</span></div><div class=line></div><div class=line>response = conn.get <span class=keyword>do</span> <span class=params>|req|</span></div><div class=line>  req.url <span class=string>'/v1/account/info'</span></div><div class=line>  req.headers[<span class=string>'API-Key'</span>] = <span class=string>'your API key'</span></div><div class=line><span class=keyword>end</span></div><div class=line></div><div class=line>responseStr  = response.body</div><div class=line>responseJson = JSON.parse(responseStr)</div><div class=line>balance = responseJson[<span class=string>'balance'</span>]</div><div class=line>pending_charges = responseJson[<span class=string>'pending_charges'</span>]</div><div class=line></div><div class=line>user = <span class=string>"your gmail"</span></div><div class=line>pass = <span class=string>"your gmail password"</span></div><div class=line>gmail = Gmail.connect(user, pass)</div><div class=line></div><div class=line>email = gmail.compose <span class=keyword>do</span></div><div class=line>  to <span class=string>"the email address receiving reports"</span></div><div class=line>  subject <span class=string>"Your Vultr balance"</span></div><div class=line>  body <span class=string>"Balance: "</span> + balance + <span class=string>"\n"</span> + <span class=string>"Pending charges: "</span> + pending_charges</div><div class=line><span class=keyword>end</span></div><div class=line>email.deliver!</div></pre></table></figure></div><footer class=article-footer><a data-url="https://www.yuxifan.com/2016/10/12/vultr-account-balance-report-in-ruby/" data-id=cix20ics5006ogag61c8qw9im class=article-share-link><i class="fa fa-share"></i>Share</a><script>(function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);</script></footer></div></article><section id=comments><div id=disqus_thread><noscript>Please enable JavaScript to view the <a href=//disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></section></div></section><aside id=sidebar><a class=sidebar-toggle title="Expand Sidebar"><i class="toggle icon"></i></a><div class=sidebar-top><p>follow:</p><ul class=social-links><li><a class=social-tooltip title=google-plus href=https://plus.google.com/104826207350368986265 target=_blank rel="external nofollow"><i class="icon fa fa-google-plus"></i></a></li><li><a class=social-tooltip title=rss href=/atom.xml target=_blank><i class="icon fa fa-rss"></i></a></li></ul></div><nav id=article-nav><a href="/2016/10/13/how-can-i-get-the-final-url-after-redirects-using-ruby/" id=article-nav-newer class=article-nav-link-wrap><strong class=article-nav-caption>newer</strong><p class=article-nav-title>How can I get the final URL after redirects using Ruby?</p><i class="icon fa fa-chevron-right" id=icon-chevron-right></i></a> <a href="/2016/10/11/image-manipulation-in-ruby/" id=article-nav-older class=article-nav-link-wrap><strong class=article-nav-caption>older</strong><p class=article-nav-title>Image Manipulation in Ruby</p><i class="icon fa fa-chevron-left" id=icon-chevron-left></i></a></nav><div class=widgets-container><div class="widget-wrap widget-list"><div class=widget><a href="https://www.vultr.com/?ref=6856003" target=_blank rel="external nofollow"><img src=/images/ads/vultr2_300x250.png></a></div></div><div class=widget-wrap><h3 class=widget-title>recents</h3><div class=widget><ul id=recent-post><li><div class=item-thumbnail><a href="/2016/12/23/sqlite3-command-line/" class=thumbnail><span style=background-image:url(/images/database/sqlite.png) alt="Sqlite3 command line" class=thumbnail-image></span></a></div><div class=item-inner><p class=item-category><a class=article-category-link href="/categories/database/">database</a></p><p class=item-title><a href="/2016/12/23/sqlite3-command-line/" class=title>Sqlite3 command line</a></p><p class=item-date><time datetime=2016-12-23T02:10:12.000Z itemprop=datePublished>2016-12-23</time></p></div></li><li><div class=item-thumbnail><a href="/2016/12/14/sending-and-receiving-custom-domain-emails-by-mailgun-and-gmail/" class=thumbnail><span style=background-image:url(/images/linux/mailgun.jpg) alt="Sending and receiving custom domain emails by mailgun and gmail" class=thumbnail-image></span></a></div><div class=item-inner><p class=item-category><a class=article-category-link href="/categories/linux/">linux</a></p><p class=item-title><a href="/2016/12/14/sending-and-receiving-custom-domain-emails-by-mailgun-and-gmail/" class=title>Sending and receiving custom domain emails by mailgun and gmail</a></p><p class=item-date><time datetime=2016-12-14T09:51:12.000Z itemprop=datePublished>2016-12-14</time></p></div></li><li><div class=item-thumbnail><a href="/2016/11/28/ruby-tutorials-rss/" class=thumbnail><span style=background-image:url(/images/ruby/rss.png) alt="Ruby tutorials - rss" class=thumbnail-image></span></a></div><div class=item-inner><p class=item-category><a class=article-category-link href="/categories/ruby/">ruby</a></p><p class=item-title><a href="/2016/11/28/ruby-tutorials-rss/" class=title>Ruby tutorials - rss</a></p><p class=item-date><time datetime=2016-11-28T02:10:12.000Z itemprop=datePublished>2016-11-28</time></p></div></li><li><div class=item-thumbnail><a href="/2016/11/25/image-manipulation-commands-in-ubuntu/" class=thumbnail><span style=background-image:url(/images/linux/image-tool/imagemagick.jpg) alt="Ubuntu image manipulation commands" class=thumbnail-image></span></a></div><div class=item-inner><p class=item-category><a class=article-category-link href="/categories/linux/">linux</a></p><p class=item-title><a href="/2016/11/25/image-manipulation-commands-in-ubuntu/" class=title>Ubuntu image manipulation commands</a></p><p class=item-date><time datetime=2016-11-25T05:51:12.000Z itemprop=datePublished>2016-11-25</time></p></div></li><li><div class=item-thumbnail><a href="/2016/11/23/report-disk-space-in-ruby/" class=thumbnail><span style=background-image:url(/images/ruby/diskspace.png) alt="How to check available disk space and email a report in Ruby" class=thumbnail-image></span></a></div><div class=item-inner><p class=item-category><a class=article-category-link href="/categories/ruby/">ruby</a></p><p class=item-title><a href="/2016/11/23/report-disk-space-in-ruby/" class=title>How to check available disk space and email a report in Ruby</a></p><p class=item-date><time datetime=2016-11-23T02:10:12.000Z itemprop=datePublished>2016-11-23</time></p></div></li></ul></div></div><div class="widget-wrap widget-list"><h3 class=widget-title>categories</h3><div class=widget><ul class=category-list><li class=category-list-item><a class=category-list-link href="/categories/css/">css</a><span class=category-list-count>1</span></li><li class=category-list-item><a class=category-list-link href="/categories/database/">database</a><span class=category-list-count>1</span></li><li class=category-list-item><a class=category-list-link href="/categories/git/">git</a><span class=category-list-count>2</span></li><li class=category-list-item><a class=category-list-link href="/categories/hexo/">hexo</a><span class=category-list-count>3</span></li><li class=category-list-item><a class=category-list-link href="/categories/java/">java</a><span class=category-list-count>2</span></li><li class=category-list-item><a class=category-list-link href="/categories/javascript/">javascript</a><span class=category-list-count>1</span></li><li class=category-list-item><a class=category-list-link href="/categories/jekyll/">jekyll</a><span class=category-list-count>1</span></li><li class=category-list-item><a class=category-list-link href="/categories/linux/">linux</a><span class=category-list-count>9</span></li><li class=category-list-item><a class=category-list-link href="/categories/ruby/">ruby</a><span class=category-list-count>18</span></li><li class=category-list-item><a class=category-list-link href="/categories/solr/">solr</a><span class=category-list-count>1</span></li><li class=category-list-item><a class=category-list-link href="/categories/tool/">tool</a><span class=category-list-count>2</span></li><li class=category-list-item><a class=category-list-link href="/categories/windows/">windows</a><span class=category-list-count>3</span></li><li class=category-list-item><a class=category-list-link href="/categories/xslt/">xslt</a><span class=category-list-count>2</span></li></ul></div></div><div class="widget-wrap widget-list"><div class=widget><a href=https://m.do.co/c/65b73b833dd9 target=_blank rel="external nofollow"><img src=/images/ads/digital-ocean-promo.gif></a></div></div><div class="widget-wrap widget-float"><h3 class=widget-title>tag cloud</h3><div class="widget tagcloud"><a href="/tags/Chinese-converter/" style="font-size: 10px">Chinese converter</a> <a href="/tags/JSTL/" style="font-size: 12.5px">JSTL</a> <a href="/tags/QR-code/" style="font-size: 10px">QR code</a> <a href="/tags/URL-redirects/" style="font-size: 10px">URL redirects</a> <a href="/tags/VM/" style="font-size: 10px">VM</a> <a href="/tags/activemq/" style="font-size: 10px">activemq</a> <a href="/tags/apt/" style="font-size: 10px">apt</a> <a href="/tags/css/" style="font-size: 10px">css</a> <a href="/tags/disqus/" style="font-size: 10px">disqus</a> <a href="/tags/dropbox/" style="font-size: 12.5px">dropbox</a> <a href="/tags/faraday/" style="font-size: 10px">faraday</a> <a href="/tags/feed/" style="font-size: 10px">feed</a> <a href="/tags/fontawesome/" style="font-size: 10px">fontawesome</a> <a href="/tags/gem/" style="font-size: 12.5px">gem</a> <a href="/tags/git/" style="font-size: 12.5px">git</a> <a href="/tags/gmail/" style="font-size: 12.5px">gmail</a> <a href="/tags/hexo/" style="font-size: 15px">hexo</a> <a href="/tags/html/" style="font-size: 10px">html</a> <a href="/tags/hyperlink/" style="font-size: 10px">hyperlink</a> <a href="/tags/image/" style="font-size: 12.5px">image</a> <a href="/tags/imagemagick/" style="font-size: 10px">imagemagick</a> <a href="/tags/incron/" style="font-size: 10px">incron</a> <a href="/tags/java/" style="font-size: 12.5px">java</a> <a href="/tags/javascript/" style="font-size: 10px">javascript</a> <a href="/tags/jekyll/" style="font-size: 10px">jekyll</a> <a href="/tags/json/" style="font-size: 10px">json</a> <a href="/tags/linux/" style="font-size: 17.5px">linux</a> <a href="/tags/mailgun/" style="font-size: 10px">mailgun</a> <a href="/tags/minify/" style="font-size: 12.5px">minify</a> <a href="/tags/nofollow/" style="font-size: 10px">nofollow</a> <a href="/tags/nokogiri/" style="font-size: 12.5px">nokogiri</a> <a href="/tags/notepad/" style="font-size: 12.5px">notepad++</a> <a href="/tags/plugin/" style="font-size: 10px">plugin</a> <a href="/tags/proxy-server/" style="font-size: 10px">proxy server</a> <a href="/tags/qr/" style="font-size: 10px">qr</a> <a href="/tags/rails/" style="font-size: 10px">rails</a> <a href="/tags/redis/" style="font-size: 12.5px">redis</a> <a href="/tags/rss/" style="font-size: 10px">rss</a> <a href="/tags/ruby/" style="font-size: 20px">ruby</a> <a href="/tags/seo/" style="font-size: 10px">seo</a> <a href="/tags/shortener/" style="font-size: 10px">shortener</a> <a href="/tags/sitemap/" style="font-size: 10px">sitemap</a> <a href="/tags/slider/" style="font-size: 10px">slider</a> <a href="/tags/solr/" style="font-size: 10px">solr</a> <a href="/tags/sqlite/" style="font-size: 10px">sqlite</a> <a href="/tags/tutorials/" style="font-size: 10px">tutorials</a> <a href="/tags/ubuntu/" style="font-size: 12.5px">ubuntu</a> <a href="/tags/vultr/" style="font-size: 10px">vultr</a> <a href="/tags/windows/" style="font-size: 12.5px">windows</a> <a href="/tags/xslt/" style="font-size: 15px">xslt</a></div></div></div></aside></div></div></div><footer id=footer><div class=container><div class=container-inner><a id=back-to-top href=javascript:;><i class="icon fa fa-angle-up"></i></a><div class=credit><p style="text-align: center">Contact me: <a href=mailto:yuxifanr@gmail.com rel="external nofollow" target=_blank>yuxifanr@gmail.com</a></p><br></div></div></div></footer><script>var disqus_shortname = 'yuxifan';
    
    
    var disqus_url = 'https://www.yuxifan.com/2016/10/12/vultr-account-balance-report-in-ruby/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><script src=/js/lightgallery/js/lightgallery.min.js></script><script src=/js/lightgallery/js/lg-thumbnail.min.js></script><script src=/js/lightgallery/js/lg-pager.min.js></script><script src=/js/lightgallery/js/lg-autoplay.min.js></script><script src=/js/lightgallery/js/lg-fullscreen.min.js></script><script src=/js/lightgallery/js/lg-zoom.min.js></script><script src=/js/lightgallery/js/lg-hash.min.js></script><script src=/js/lightgallery/js/lg-share.min.js></script><script src=/js/lightgallery/js/lg-video.min.js></script><script src=/js/main.js></script></div>